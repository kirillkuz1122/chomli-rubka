<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Qubit</title>
        <meta
            name="description"
            content="Турниры на скорость и логику. Вход по коду, по логину или регистрация."
        />
        <style>
            :root {
                --bg-1: #0b1220;
                --bg-2: #020617;
                --fg: #e2e8f0;
                --fg-strong: #f8fafc;
                --fg-muted: #94a3b8;
                --muted: rgba(255, 255, 255, 0.06);
                --muted-2: rgba(255, 255, 255, 0.08);
                --border: rgba(255, 255, 255, 0.1);
                --border-2: rgba(255, 255, 255, 0.2);
                --card: rgba(255, 255, 255, 0.06);
                --card-border: rgba(255, 255, 255, 0.1);
                --accent-from: #f43f5e;
                --accent-to: #f59e0b;
                --green: #22c55e;
                --green-2: #16a34a;
                --container: 80rem;
                --header-h: 56px;
                --radius: 16px;
                --grid-o: 0.05; /* прозрачность сетки */
                color-scheme: dark;
                --formula-o: 0.1;
                --formula-color: #fff;
                --formula-blend: overlay;
                --grid-o: 0.05; /* базовая видимость в тёмной теме */
                --grid-color: rgba(
                    255,
                    255,
                    255,
                    0.9
                ); /* белые линии для тёмной темы */
                --grid-size: 32px;
            }
            :root[data-theme="light"] {
                --grid-o: 0.1; /* делаем заметнее на светлом */
                --grid-color: rgba(2, 6, 23, 0.65);
                --bg-1: #f6f7fb;
                --bg-2: #ffffff;
                --fg: #0b1220;
                --fg-strong: #020617;
                --fg-muted: #4b5563;
                --muted: rgba(0, 0, 0, 0.06);
                --muted-2: rgba(0, 0, 0, 0.08);
                --border: rgba(0, 0, 0, 0.1);
                --border-2: rgba(0, 0, 0, 0.2);
                --card: rgba(0, 0, 0, 0.04);
                --card-border: rgba(0, 0, 0, 0.08);
                --grid-o: 0.08;
                color-scheme: light;
                --formula-o: 0.16; /* чуть заметнее на светлом фоне */
                --formula-color: #334155; /* тёмно-серый вместо белого */
                --formula-blend: multiply; /* лучше «приклеивается» к светлому фону */
                --grid-o: 0.04;
            }
            #themeToggle svg {
                display: block;
            }
            #themeToggle .sun {
                display: none;
            }
            [data-theme="light"] #themeToggle .sun {
                display: block;
            }
            [data-theme="light"] #themeToggle .moon {
                display: none;
            }
            body,
            .header,
            .card,
            .drawer__panel,
            .modal__panel {
                transition: background-color 0.25s ease, color 0.25s ease,
                    border-color 0.25s ease;
            }
            /* Скрыть горизонтальный скролл у карусели */
            html,
            body {
                /* прокрутка остаётся, но полоса скрыта */
                overflow: auto;
                -ms-overflow-style: none; /* IE/старый Edge */
                scrollbar-width: none; /* Firefox */
            }
            html::-webkit-scrollbar,
            body::-webkit-scrollbar {
                width: 0;
                height: 0;
                display: none; /* Chrome/Safari/новый Edge */
            }

            /* Скрыть горизонтальный скролл у карусели */
            .hscroll {
                scrollbar-width: none; /* Firefox */
                -ms-overflow-style: none; /* IE/Edge legacy */
            }
            .hscroll::-webkit-scrollbar {
                /* Chrome/Safari/Edge */
                height: 0;
                display: none;
            }
            .hscroll::-webkit-scrollbar-track {
                background: transparent;
            }
            .hscroll::-webkit-scrollbar-thumb {
                background: transparent;
            }
            * {
                box-sizing: border-box;
            }
            html,
            body {
                height: 100%;
            }
            body {
                margin: 0;
                font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
                    Cantarell, Noto Sans, Helvetica, Arial;
                background: radial-gradient(
                        ellipse at top,
                        rgba(244, 63, 94, 0.2),
                        transparent 45%
                    ),
                    radial-gradient(
                        ellipse at bottom,
                        rgba(251, 191, 36, 0.2),
                        transparent 50%
                    ),
                    linear-gradient(var(--bg-2), var(--bg-1) 55%, var(--bg-2));
                color: var(--fg);
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                padding-top: var(--header-h);
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }
            a {
                color: inherit;
                text-decoration: none;
            }
            .container {
                width: 100%;
                max-width: var(--container);
                margin-inline: auto;
                padding-inline: 16px;
            }

            /* GRID overlay */
            .grid {
                opacity: var(--grid-o);
                background-image: linear-gradient(
                        to right,
                        var(--grid-color) 1px,
                        transparent 1px
                    ),
                    linear-gradient(
                        to bottom,
                        var(--grid-color) 1px,
                        transparent 1px
                    );
                background-size: var(--grid-size) var(--grid-size);
                pointer-events: none;
                position: fixed;
                inset: 0;
                z-index: -1;
            }
            @media (prefers-contrast: more) {
                .grid {
                    opacity: calc(var(--grid-o) + 0.05);
                }
            }

            /* HEADER */
            .header {
                position: fixed;
                inset: 0 0 auto 0;
                height: var(--header-h);
                z-index: 1000;
                backdrop-filter: saturate(1.1) blur(8px);
                background: color-mix(in oklab, var(--bg-2) 75%, transparent);
                border-bottom: 1px solid var(--border);
            }
            .header__inner {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
            }
            .brand {
                display: flex;
                align-items: center;
                gap: 10px;
                font-weight: 800;
                color: var(--fg-strong);
            }
            .brand__chip {
                display: grid;
                place-items: center;
                width: 28px;
                height: 28px;
                border-radius: 10px;
                color: var(--bg-1);
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
            }
            .brand__text {
                letter-spacing: 0.02em;
            }
            .nav {
                display: none;
                gap: 24px;
                color: color-mix(in oklab, var(--fg), #fff 5%);
            }
            .nav__link {
                font-size: 14px;
            }
            .nav__link:hover {
                color: var(--fg-strong);
            }
            @media (min-width: 992px) {
                .nav {
                    display: flex;
                }
            }
            .header__actions {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            .btn {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                border-radius: 12px;
                padding: 10px 14px;
                font-size: 15px;
                border: 1px solid transparent;
                cursor: pointer;
                color: var(--fg);
            }
            .btn--muted {
                background: var(--muted);
                border-color: var(--border);
            }
            .btn--muted:hover {
                background: var(--muted-2);
            }
            .btn--accent {
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                color: #0b1220;
                font-weight: 800;
                border: none;
                display: flex;
                justify-content: center;
            }
            .btn--icon-only {
                padding: 10px;
                width: 40px;
                height: 40px;
                justify-content: center;
                border: 1px solid var(--border);
                border-radius: 12px;
                background: var(--muted);
            }
            .i {
                display: block;
            }

            /* DRAWER */
            .drawer {
                position: fixed;
                inset: 0;
                z-index: 2000;
                display: grid;
                grid-template-columns: 1fr;
                pointer-events: none;
            }
            .drawer[hidden] {
                display: none;
            }
            .drawer__backdrop {
                grid-row: 1;
                grid-column: 1;
                background: rgba(0, 0, 0, 0.55);
                opacity: 0;
                transition: opacity 0.2s;
            }
            .drawer__panel {
                grid-row: 1;
                grid-column: 1;
                justify-self: end;
                width: min(92vw, 360px);
                height: 100vh;
                background: var(--bg-1);
                border-left: 1px solid var(--border);
                transform: translateX(102%);
                transition: transform 0.28s;
                display: flex;
                flex-direction: column;
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
            .drawer--open .drawer__backdrop {
                opacity: 1;
                pointer-events: auto;
            }
            .drawer--open .drawer__panel {
                transform: translateX(0);
                pointer-events: auto;
            }
            .drawer__top {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 8px;
                padding: 12px 16px;
                position: sticky;
                top: 0;
                background: color-mix(in oklab, var(--bg-1) 92%, transparent);
                border-bottom: 1px solid var(--border);
            }
            .drawer__user {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .avatar {
                display: grid;
                place-items: center;
                width: 32px;
                height: 32px;
                border-radius: 999px;
                background: var(--muted-2);
                font-weight: 800;
            }
            .drawer__close {
                background: var(--muted);
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 8px;
                width: 40px;
                height: 40px;
                cursor: pointer;
            }
            .drawer__nav {
                display: flex;
                flex-direction: column;
                gap: 12px;
                padding: 16px;
            }
            .drawer__link {
                padding: 12px;
                border-radius: 12px;
                background: var(--muted);
                border: 1px solid var(--border);
            }
            .drawer__link:hover {
                background: var(--muted-2);
            }

            /* SIDE DOTS */
            .side-nav {
                position: fixed;
                right: 12px;
                top: 50%;
                transform: translateY(-50%);
                z-index: 900;
                display: none;
                flex-direction: column;
                gap: 12px;
                align-items: center;
            }
            @media (min-width: 1200px) {
                .side-nav {
                    display: flex;
                    right: 24px;
                }
            }
            .side-nav__dot {
                position: relative;
                display: grid;
                place-items: center;
                width: 12px;
                height: 12px;
                border-radius: 999px;
                border: 1px solid color-mix(in oklab, #fff 20%, transparent);
                background: var(--muted);
                transition: transform 0.2s, background 0.2s;
            }
            .side-nav__dot:hover {
                transform: scale(1.1);
            }
            .side-nav__dot.active {
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                border-color: transparent;
            }
            .side-nav__dot::after {
                content: attr(data-label);
                position: absolute;
                right: 150%;
                white-space: nowrap;
                background: color-mix(in oklab, var(--bg-2) 90%, transparent);
                color: var(--fg);
                font-size: 12px;
                padding: 4px 8px;
                border-radius: 8px;
                border: 1px solid var(--border);
                opacity: 0;
                transform: translateX(6px);
                pointer-events: none;
                transition: opacity 0.15s, transform 0.15s;
            }
            .side-nav__dot:hover::after {
                opacity: 1;
                transform: translateX(0);
            }

            /* HERO */
            .hero {
                position: relative;
            }
            .hero__stage {
                position: sticky;
                top: 0;
                min-height: calc(var(--vh, 1vh) * 100);
                min-height: 100svh;
                display: grid;
                place-items: center;
                overflow: hidden;
                padding-top: 28px;
            }
            .hero__inner {
                display: grid;
                gap: 18px;
                justify-items: center;
                padding-inline: 16px;
                padding-block: 64px;
            }
            .card--all {
                display: grid;
                place-items: center;
                text-align: center;
                gap: 10px;
                min-height: 220px; /* чтобы по высоте не отличалась */
            }
            .card--all .cta {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 12px 16px;
                border-radius: 14px;
                font-weight: 900;
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                color: #0b1220;
                border: none;
            }
            .card--all .desc {
                font-size: 14px;
                color: var(--fg-muted);
            }
            .card--all svg {
                display: block;
            }
            .card--all:hover {
                filter: brightness(1.05);
            }
            .word {
                font-weight: 1000;
                line-height: 1;
                letter-spacing: -0.02em;
                text-align: center;
                font-size: 1000px; /* base, JS will fit */
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                background-size: 200% 100%;
                background-position: 0% 50%;
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
                filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.35));
                animation: breathe 4s ease-in-out infinite,
                    gloss 3.5s ease-in-out infinite;
                white-space: nowrap;
                max-width: 100%;
            }
            @keyframes breathe {
                0% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.02);
                }
                100% {
                    transform: scale(1);
                }
            }
            @keyframes gloss {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            @media (prefers-reduced-motion: reduce) {
                .word {
                    animation: none;
                }
            }
            .tagline {
                font-size: clamp(14px, 2.6vw, 18px);
                color: var(--fg-muted);
            }

            /* Formulas in HERO only */
            .formulas {
                position: absolute;
                inset: 0;
                pointer-events: none;
                opacity: 0.1;
            }
            .formulas span {
                position: absolute;
                font-family: ui-monospace, SFMono-Regular, Menlo, Consolas,
                    "Liberation Mono", monospace;
                color: #fff;
                font-weight: 700;
                mix-blend-mode: overlay;
                opacity: 0.9;
                transform: rotate(var(--rot, 0deg));
                white-space: nowrap;
            }
            .formulas .f1 {
                left: 6%;
                top: 20%;
                font-size: 28px;
                --rot: -14deg;
            }
            .formulas .f2 {
                left: 64%;
                top: 18%;
                font-size: 22px;
                --rot: 8deg;
            }
            .formulas .f3 {
                left: 22%;
                top: 60%;
                font-size: 26px;
                --rot: -8deg;
            }
            .formulas .f4 {
                left: 72%;
                top: 64%;
                font-size: 24px;
                --rot: 12deg;
            }
            .formulas .f5 {
                left: 40%;
                top: 34%;
                font-size: 20px;
                --rot: -6deg;
            }
            .formulas .f6 {
                left: 12%;
                top: 72%;
                font-size: 18px;
                --rot: 5deg;
            }
            .formulas .f7 {
                left: 78%;
                top: 42%;
                font-size: 19px;
                --rot: -10deg;
            }
            .formulas .f8 {
                left: 52%;
                top: 76%;
                font-size: 17px;
                --rot: 7deg;
            }
            .formulas .f9 {
                left: 30%;
                top: 16%;
                font-size: 21px;
                --rot: -4deg;
            }
            .formulas .f10 {
                left: 86%;
                top: 28%;
                font-size: 18px;
                --rot: 9deg;
            }

            /* Sections */
            .section {
                padding-block: 56px;
            }
            .kicker {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 4px 10px;
                font-size: 12px;
                color: color-mix(in oklab, var(--fg), #fff 5%);
                border-radius: 999px;
                border: 1px solid var(--border);
                background: var(--muted);
                width: max-content;
            }
            .section__title {
                font-size: clamp(22px, 3vw, 36px);
                color: var(--fg-strong);
                font-weight: 900;
                margin: 8px 0;
            }
            .accent-bar {
                height: 4px;
                width: 110px;
                border-radius: 999px;
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                margin-top: 6px;
                margin-bottom: 10px;
            }
            .lead {
                margin-top: 12px;
                color: color-mix(in oklab, var(--fg), #fff 5%);
                line-height: 1.75;
            }

            /* WHAT */
            .what__title {
                font-size: clamp(26px, 4.6vw, 40px);
                font-weight: 900;
                color: var(--fg-strong);
                margin: 6px 0;
            }
            .feature-card {
                display: flex;
                gap: 12px;
                align-items: center;
                background: color-mix(in oklab, var(--bg-1) 85%, transparent);
                border: 1px solid var(--border);
                border-radius: 18px;
                padding: 12px 14px;
            }
            .feature-card + .feature-card {
                margin-top: 10px;
            }
            .feature-card__icon {
                width: 36px;
                height: 36px;
                border-radius: 12px;
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
            }
            .feature-card__title {
                font-weight: 800;
                color: var(--fg-strong);
            }
            .feature-card__sub {
                font-size: 14px;
                color: color-mix(in oklab, var(--fg), #fff 10%);
            }
            .note {
                display: flex;
                gap: 10px;
                align-items: flex-start;
                margin-top: 12px;
                color: var(--fg-muted);
            }
            .note__icon {
                width: 22px;
                height: 22px;
                border-radius: 8px;
                display: grid;
                place-items: center;
                background: var(--muted);
                border: 1px solid var(--border);
            }

            /* Horizontal tournaments */
            .hscroll-wrap {
                position: relative;
            }
            .hscroll {
                display: grid;
                grid-auto-flow: column;
                grid-auto-columns: 85%;
                gap: 16px;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                padding-block: 6px;
            }
            .hscroll > * {
                scroll-snap-align: start;
            }
            @media (min-width: 640px) {
                .hscroll {
                    grid-auto-columns: 50%;
                }
            }
            @media (min-width: 1200px) {
                .hscroll {
                    grid-auto-columns: 33.333%;
                }
            }
            .hscroll__controls {
                position: absolute;
                inset: auto 0 100% 0;
                display: flex;
                justify-content: flex-end;
                gap: 8px;
                padding-bottom: 8px;
            }
            .card {
                position: relative;
                overflow: hidden;
                border-radius: 16px;
                border: 1px solid var(--card-border);
                background: var(--card);
                padding: 16px;
            }
            .card__topbar {
                position: absolute;
                inset: 0 0 auto 0;
                height: 4px;
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
            }
            .card__head {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
                margin-bottom: 12px;
            }
            .meta {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                font-size: 12px;
                color: color-mix(in oklab, var(--fg), #fff 5%);
            }
            .status {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                font-size: 12px;
                padding: 4px 10px;
                border-radius: 999px;
                border: 1px solid var(--border);
            }
            .status .dot {
                width: 6px;
                height: 6px;
                border-radius: 999px;
                background: currentColor;
                display: inline-block;
            }
            .status--soon {
                color: #fde68a;
                background: rgba(253, 230, 138, 0.1);
                border-color: rgba(253, 230, 138, 0.3);
            }
            .status--live {
                color: #86efac;
                background: rgba(134, 239, 172, 0.1);
                border-color: rgba(134, 239, 172, 0.3);
            }
            .status--ended {
                color: #cbd5e1;
                background: rgba(203, 213, 225, 0.08);
                border-color: rgba(203, 213, 225, 0.3);
            }
            .card__title {
                color: var(--fg-strong);
                font-weight: 800;
                font-size: 18px;
                margin: 0;
            }
            .card__sub {
                margin: 4px 0 0;
                color: color-mix(in oklab, var(--fg), #fff 5%);
                font-size: 14px;
            }
            .card__meta {
                display: flex;
                justify-content: space-between;
                gap: 8px;
                margin-top: 12px;
                color: color-mix(in oklab, var(--fg), #fff 5%);
                font-size: 14px;
                flex-wrap: wrap;
            }
            .card__actions {
                display: flex;
                gap: 8px;
                margin-top: 16px;
                flex-wrap: wrap;
            }

            /* TOP players (с круглыми номерами) */
            .board {
                margin-top: 16px;
                border: 1px solid var(--border);
                border-radius: 22px;
                background: color-mix(in oklab, var(--bg-1) 85%, transparent);
                overflow: hidden;
            }
            .row {
                display: grid;
                grid-template-columns: auto auto 1fr auto;
                align-items: center;
                gap: 12px;
                padding: 12px 14px;
                border-top: 1px solid var(--border);
                min-height: 89px;
            }
            .row:first-child {
                border-top: none;
            }
            /* кружки 1–3 как на скрине */
            .rankchip {
                display: grid;
                place-items: center;
                width: 44px;
                height: 44px;
                border-radius: 14px;
                font-weight: 900;
                font-size: 18px;
                color: #0b1220;
                border: 1px solid rgba(0, 0, 0, 0.06);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25),
                    inset 0 1px 0 rgba(255, 255, 255, 0.25);
            }
            .rankchip--1 {
                background-image: linear-gradient(135deg, #f59e0b, #fbbf24);
            }
            .rankchip--2 {
                background-image: linear-gradient(135deg, #e5e7eb, #94a3b8);
                color: #0f172a;
            }
            .rankchip--3 {
                background-image: linear-gradient(135deg, #f97316, #ea580c);
            }
            .rankchip--n {
                background: var(--muted);
                color: var(--fg);
            }
            /* аватар-инициалы */
            .badge {
                display: grid;
                place-items: center;
                width: 40px;
                height: 40px;
                border-radius: 12px;
                background: var(--muted);
                border: 1px solid var(--border);
                font-weight: 800;
                color: var(--fg-strong);
            }
            .row__mid {
                display: grid;
            }
            .row__name {
                font-weight: 900;
                color: var(--fg-strong);
            }
            .row__sub {
                font-size: 13px;
                color: color-mix(in oklab, var(--fg), #fff 10%);
            }
            .row__right {
                display: grid;
                gap: 4px;
                justify-items: end;
            }
            .score {
                padding: 10px 12px;
                border-radius: 14px;
                background: linear-gradient(
                    135deg,
                    color-mix(in oklab, var(--green) 22%, transparent),
                    color-mix(in oklab, var(--green-2) 18%, transparent)
                );
                border: 1px solid
                    color-mix(in oklab, var(--green) 40%, transparent);
                font-weight: 900;
                color: #d1fae5;
                min-width: 96px;
                text-align: center;
            }
            .wins {
                font-size: 13px;
                color: color-mix(in oklab, var(--fg), #fff 12%);
            }
            .topbar-btn {
                margin-left: auto;
                border: 1px solid var(--border);
                background: var(--muted);
                border-radius: 18px;
                padding: 8px 12px;
                color: color-mix(in oklab, var(--fg), #fff 6%);
                display: inline-flex;
                gap: 8px;
                align-items: center;
            }

            /* FOOTER */
            .footer {
                margin-top: 32px;
                border-top: 1px solid var(--border);
                background: color-mix(in oklab, var(--bg-2) 75%, transparent);
            }
            .footer__grid {
                display: grid;
                gap: 16px;
                padding: 24px 0;
                padding-left: 10px;
                padding-right: 10px;
            }
            @media (min-width: 640px) {
                .footer__grid {
                    grid-template-columns: 1fr 1fr;
                }
            }
            .footer__brand {
                font-weight: 800;
                color: var(--fg-strong);
                font-size: 18px;
            }
            .footer__text {
                margin-top: 8px;
                color: var(--fg-muted);
                font-size: 14px;
            }
            .footer__links {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-top: 6px;
            }
            .footer__link {
                color: var(--fg);
                opacity: 0.9;
            }
            .footer__copy {
                margin-top: 10px;
                color: var(--fg-muted);
                font-size: 14px;
            }

            /* Modal */
            .modal {
                position: fixed;
                inset: 0;
                z-index: 2100;
                display: grid;
                grid-template-columns: 1fr;
                place-items: center;
            }
            .modal[hidden] {
                display: none;
            }
            .modal__backdrop {
                position: absolute;
                inset: 0;
                background: rgba(0, 0, 0, 0.6);
                opacity: 0;
                transition: opacity 0.2s;
            }
            .modal__panel {
                position: relative;
                width: min(92vw, 440px);
                border-radius: 16px;
                background: var(--bg-1);
                border: 1px solid var(--border);
                padding: 16px;
                transform: translateY(10px);
                opacity: 0;
                transition: transform 0.2s, opacity 0.2s;
            }
            .modal--open .modal__backdrop {
                opacity: 1;
            }
            .modal--open .modal__panel {
                opacity: 1;
                transform: translateY(0);
            }
            .modal__head {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            .modal__title {
                font-weight: 800;
                color: var(--fg-strong);
                font-size: 18px;
            }
            .modal__close {
                background: var(--muted);
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 8px;
                width: 40px;
                height: 40px;
                cursor: pointer;
            }
            .modal__body {
                display: grid;
                gap: 10px;
            }
            .modal__note {
                font-size: 12px;
                color: var(--fg-muted);
                margin-top: 6px;
            }

            /* Reveal */
            [data-reveal] {
                opacity: 0;
                transform: translateY(18px);
                transition: opacity 0.6s ease, transform 0.6s ease;
            }
            [data-reveal].in {
                opacity: 1;
                transform: translateY(0);
            }
            .formulas {
                opacity: var(--formula-o);
            }
            .formulas span {
                color: var(--formula-color);
                mix-blend-mode: var(--formula-blend);
            }
            @supports (-webkit-text-stroke: 1px black) {
                /* тонкий контур на светлой теме — ещё +читабельность */
                [data-theme="light"] .formulas span {
                    -webkit-text-stroke: 0.4px rgba(0, 0, 0, 0.06);
                }
            }

            /* -------- 2) Контраст статусов (жёлтый/зелёный/серый) -------- */
            [data-theme="light"] .status--soon {
                color: #a16207; /* тёмный янтарный (AA) */
                background: #fef3c7; /* светло-жёлтая подложка */
                border-color: #f59e0b33;
            }
            [data-theme="light"] .status--live {
                color: #166534; /* тёмный зелёный (AA) */
                background: #dcfce7; /* светло-зелёная подложка */
                border-color: #16a34a33;
            }
            [data-theme="light"] .status--ended {
                color: #374151; /* графитовый текст */
                background: #f3f4f6; /* нейтральная подложка */
                border-color: #94a3b833;
            }

            /* -------- 3) «Очки» в топе — сделать читаемыми на светлом -------- */
            [data-theme="light"] .score {
                background: #bbf7d0; /* монолитная светло-зелёная, без градиента */
                color: #065f46; /* тёмный текст для контраста */
                border: 1px solid #34d399;
                text-shadow: none;
            }

            /* -------- 4) Нейтральные элементы (серые) чуть темнее -------- */
            [data-theme="light"] .badge {
                background: #eef2f7;
                color: #0b1220;
                border-color: #cbd5e1;
            }
            [data-theme="light"] .board {
                border-color: #e5e7eb;
            }
            [data-theme="light"] .row {
                border-top-color: #e5e7eb;
            }
            /* Кнопка-плитка "Все турниры" — аккуратный вид */
            .card--all {
                display: flex;
                justify-content: right;
                position: relative;
                display: grid;
                place-items: center; /* запас справа под стрелку */
                min-height: 200px; /* как у обычных карточек */
                width: 244px;
                padding-right: 80px;
                border-radius: 24px;
                border: 1px solid rgba(0, 0, 0, 0.08);
                background: radial-gradient(
                        120% 120% at 0% 0%,
                        rgba(255, 255, 255, 0.18),
                        transparent 38%
                    ),
                    linear-gradient(
                        135deg,
                        var(--accent-from) 0%,
                        #f97316 60%,
                        var(--accent-to) 100%
                    );
                color: #0b1220;
                transition: transform 0.15s ease, filter 0.15s ease;
            }
            .card--all .card__topbar {
                display: none;
            }
            .card--all .label {
                font-weight: 900;
                font-size: clamp(18px, 2.6vw, 22px);
                letter-spacing: 0.01em;
            }
            .card--all .arrow {
                position: absolute;
                right: 18px;
                top: 50%;
                transform: translateY(-50%);
                width: 44px;
                height: 44px;
                border-radius: 50%;
                display: grid;
                place-items: center;
                background: rgba(255, 255, 255, 0.92);
                color: #0b1220;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.18),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6);
                transition: transform 0.15s ease, background 0.15s ease;
            }
            .card--all:hover {
                transform: translateY(-2px);
            }
            .card--all:hover .arrow {
                transform: translate(2px, -50%);
            }
            .card--all:active {
                transform: translateY(0);
                filter: saturate(0.98);
            }

            /* корректировки для тёмной/светлой темы */
            :root[data-theme="light"] .card--all {
                border-color: rgba(0, 0, 0, 0.08);
            }
            :root:not([data-theme="light"]) .card--all {
                border-color: rgba(255, 255, 255, 0.12);
            }
            :root {
                --btn-float: 2px; /* подъём при hover */
                --btn-press-bright: 0.98; /* затемнение при active */
                --btn-press-sat: 0.98;
            }

            /* Какие элементы считаем кнопками */
            .btn,
            .topbar-btn,
            .drawer__link,
            .drawer__close,
            .modal__close,
            #burger,
            #drawerClose,
            #modalClose {
                position: relative;
                transition: transform 0.15s ease, box-shadow 0.15s ease,
                    filter 0.15s ease, background-color 0.15s ease,
                    border-color 0.15s ease, color 0.15s ease;
                will-change: transform, filter;
            }

            /* Подъём и усиление тени при hover */
            .btn:hover,
            .topbar-btn:hover,
            .drawer__link:hover,
            .drawer__close:hover,
            .modal__close:hover,
            #burger:hover,
            #drawerClose:hover,
            #modalClose:hover {
                transform: translateY(calc(-1 * var(--btn-float)));
            }

            /* Акцентным добавим чуть более заметную тень при hover */
            .btn--accent:hover {
                box-shadow: 0 12px 28px rgba(0, 0, 0, 0.18);
                filter: saturate(1.05);
            }

            /* «Мутным» — лёгкое подсветление фона при hover */
            .btn--muted:hover,
            .drawer__link:hover,
            .topbar-btn:hover {
                box-shadow: 0 10px 22px rgba(0, 0, 0, 0.14);
                filter: brightness(1.03);
            }

            /* Икон-кнопки — микро-масштаб, чтобы не «прыгали» слишком */
            .btn--icon-only:hover,
            .drawer__close:hover,
            .modal__close:hover,
            #burger:hover {
                transform: translateY(calc(-0.6 * var(--btn-float))) scale(1.02);
            }

            /* Состояние active (нажатие) — опускаем обратно и немного приглушаем */
            .btn:active,
            .topbar-btn:active,
            .drawer__link:active,
            .drawer__close:active,
            .modal__close:active,
            #burger:active,
            #drawerClose:active,
            #modalClose:active {
                transform: translateY(0) scale(0.99);
                filter: brightness(var(--btn-press-bright))
                    saturate(var(--btn-press-sat));
                box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
            }

            /* Фокус-кольцо для клавиатуры */
            .btn:focus-visible,
            .topbar-btn:focus-visible,
            .drawer__link:focus-visible,
            .drawer__close:focus-visible,
            .modal__close:focus-visible,
            #burger:focus-visible,
            #drawerClose:focus-visible,
            #modalClose:focus-visible {
                outline: 3px solid
                    color-mix(in oklab, #fff 75%, var(--accent-to));
                outline-offset: 2px;
                border-color: transparent;
            }

            /* Уважение prefers-reduced-motion — делаем движения мягче */
            @media (prefers-reduced-motion: reduce) {
                .btn,
                .topbar-btn,
                .drawer__link,
                .drawer__close,
                .modal__close,
                #burger,
                #drawerClose,
                #modalClose {
                    transition-duration: 0.05s;
                }
                .btn:hover,
                .topbar-btn:hover,
                .drawer__link:hover,
                .drawer__close:hover,
                .modal__close:hover,
                #burger:hover,
                #drawerClose:hover,
                #modalClose:hover {
                    transform: translateY(-1px);
                }
            }
            /* герой-зона занимает экран МИНУС фиксированный хэдэр */
            .hero__stage {
                position: sticky; /* можно оставить sticky */
                top: 0;
                min-height: 100svh;
                margin-top: -55px;
                display: grid;
                place-items: center; /* центр по горизонтали и вертикали */
                padding: 0; /* убираем лишние отступы сверху/снизу */
            }

            /* внутренний контейнер — компактные отступы и центр текста */
            .hero__inner {
                display: grid;
                gap: 16px;
                justify-items: center;
                text-align: center;
                padding: clamp(12px, 3vw, 24px);
                margin: 0 auto;
                max-width: min(1100px, 100% - 32px);
            }
            /* hero-кнопка: сочный градиент, мягкая тень, блик */
            .btn--hero {
                position: relative;
                border: none;
                padding: 14px 28px;
                border-radius: 999px;
                font-weight: 900;
                background-image: linear-gradient(
                    90deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                color: #0b1220;
                box-shadow: 0 10px 26px rgba(0, 0, 0, 0.18);
                transition: transform 0.15s ease, box-shadow 0.15s ease,
                    filter 0.15s ease;
            }
            .btn--hero::after {
                content: "";
                position: absolute;
                inset: 0;
                border-radius: inherit;
                background: linear-gradient(
                    to bottom,
                    rgba(255, 255, 255, 0.28),
                    transparent 42%
                );
                pointer-events: none;
            }

            /* ховер/актив — как у плитки "Все турниры" */
            .btn--hero:hover {
                transform: translateY(-2px);
                filter: saturate(1.05);
                box-shadow: 0 14px 32px rgba(0, 0, 0, 0.22);
            }
            .btn--hero:active {
                transform: translateY(0) scale(0.99);
                filter: brightness(0.98);
                box-shadow: 0 8px 18px rgba(0, 0, 0, 0.14);
            }

            /* фокус-кольцо */
            .btn--hero:focus-visible {
                outline: 3px solid
                    color-mix(in oklab, #fff 75%, var(--accent-to));
                outline-offset: 3px;
            }
            @media (max-width: 640px) {
                .hero__inner {
                    gap: 12px;
                }
            }
            /* ===== Drawer 2.0 ===== */
            .drawer__panel {
                background: color-mix(in oklab, var(--bg-1) 92%, transparent);
            }
            /* верхняя плашка с мягкой линией */
            .drawer__top {
                border-bottom: 1px solid var(--border);
                background: color-mix(in oklab, var(--bg-1) 96%, transparent);
            }

            /* usercard c градиентным кольцом */
            .drawer__usercard {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 14px 16px;
            }
            .avatar--ring {
                position: relative;
                width: 40px;
                height: 40px;
                border-radius: 999px;
                display: grid;
                place-items: center;
                background: var(--muted);
            }
            .avatar--ring::before {
                content: "";
                position: absolute;
                inset: -2px;
                border-radius: inherit;
                background: conic-gradient(
                    from 180deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                -webkit-mask: linear-gradient(#000 0 0) content-box,
                    linear-gradient(#000 0 0);
                -webkit-mask-composite: xor;
                mask-composite: exclude;
                padding: 2px;
            }
            .user-meta {
                display: grid;
                line-height: 1.2;
            }
            .user-name {
                font-weight: 800;
                color: var(--fg-strong);
            }
            .user-role {
                font-size: 12px;
                color: var(--fg-muted);
            }

            /* группы меню */
            .drawer__group {
                padding: 10px 16px;
            }
            .drawer__label {
                font-size: 12px;
                color: var(--fg-muted);
                margin: 0 0 8px 2px;
            }

            /* пункт меню как мини-карточка */
            .drawer__item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
                padding: 12px 14px;
                border-radius: 14px;
                background: var(--muted);
                border: 1px solid var(--border);
                transition: transform 0.14s ease, background 0.14s ease,
                    box-shadow 0.14s ease;
            }
            .drawer__item + .drawer__item {
                margin-top: 10px;
            }
            .drawer__item:hover {
                transform: translateY(-2px);
                background: var(--muted-2);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.14);
            }
            .drawer__item:active {
                transform: translateY(0) scale(0.99);
            }
            .drawer__item .left {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .drawer__item .ico {
                width: 36px;
                height: 36px;
                border-radius: 12px;
                display: grid;
                place-items: center;
                color: #0b1220;
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                box-shadow: inset 0 1px rgba(255, 255, 255, 0.5);
            }
            .drawer__item .chev {
                opacity: 0.7;
            }

            /* нижние экшены */
            .drawer__actions {
                padding: 8px 16px 16px;
                display: grid;
                gap: 10px;
                margin: auto 0;
            }
            .btn--block {
                width: 100%;
                justify-content: center;
            }

            /* тоньше скролл у панели, без полос на iOS */
            .drawer__panel {
                overscroll-behavior: contain;
            }
            /* 1) Панель без прокрутки и полос */
            .drawer__panel {
                height: 100svh;
                max-height: 100svh;
                overflow: hidden; /* убираем скролл внутри панели */
                scrollbar-width: none;
            }
            .drawer__panel::-webkit-scrollbar {
                display: none;
            }

            /* 2) Топ меню: юзер слева, иконки справа */
            .drawer__top {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 12px 16px;
                position: sticky;
                top: 0;
                border-bottom: 1px solid var(--border);
                background: color-mix(in oklab, var(--bg-1) 96%, transparent);
            }
            .drawer__usercard {
                flex: 1;
                padding: 0;
            } /* тянем влево */
            .drawer__right {
                margin-left: auto;
                display: flex;
                gap: 8px;
                align-items: center;
            }

            /* 3) Прячем «Навигация» */
            .drawer__label {
                display: none;
            }

            /* 4) Иконка темы как в хедере */
            #themeToggleDrawerIcon svg {
                display: block;
            }
            #themeToggleDrawerIcon .sun {
                display: none;
            }
            [data-theme="light"] #themeToggleDrawerIcon .sun {
                display: block;
            }
            [data-theme="light"] #themeToggleDrawerIcon .moon {
                display: none;
            }

            /* 5) На всякий случай — убрать скролл у самого списка */
            .drawer__nav {
                overflow: hidden;
            }

            /* (необязательно) если оставалась нижняя кнопка темы — скрыть */
            .drawer__actions [data-role="theme-btn"] {
                display: none;
            }
            /* Тюним открытие/закрытие */
            :root {
                --tr-open: cubic-bezier(0.22, 1, 0.36, 1);
                --tr-close: cubic-bezier(0.4, 0, 0.2, 1);
            }

            .drawer__panel {
                transform: translateX(102%);
                transition: transform 0.34s var(--tr-open), opacity 0.2s ease;
            }
            .drawer__backdrop {
                opacity: 0;
                transition: opacity 0.22s ease;
            }

            /* открыто */
            .drawer--open .drawer__panel {
                transform: translateX(0);
                opacity: 1;
            }
            .drawer--open .drawer__backdrop {
                opacity: 1;
            }

            /* плавное закрытие (отдельный тайминг) */
            .drawer--closing .drawer__panel {
                transform: translateX(102%);
                transition: transform 0.3s var(--tr-close), opacity 0.2s ease;
            }
            .drawer--closing .drawer__backdrop {
                opacity: 0;
            }

            @media (prefers-reduced-motion: reduce) {
                .drawer__panel,
                .drawer__backdrop {
                    transition: none !important;
                }
            }
            @media (max-width: 400px) {
                h2.section__title.in {
                    width: 200px;
                }
            }
            /* CTA-строка "Ещё" внизу таблицы рейтинга */
            .row--cta {
                display: grid;
                grid-template-columns: 1fr auto; /* текст слева, стрелка справа */
                align-items: center;
                padding: 12px 14px; /* как у .row */
                min-height: calc(
                    44px + 24px
                ); /* высота как у ряда с rankchip 44px */
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                color: #0b1220;
                font-weight: 900;
                border-top: 1px solid rgba(0, 0, 0, 0.08);
            }
            .row--cta .label {
                font-size: 16px;
                letter-spacing: 0.01em;
                margin-bottom: 2px;
            }
            .row--cta .arrow {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: grid;
                place-items: center;
                flex: 0 0 auto;
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6),
                    0 2px 8px rgba(0, 0, 0, 0.18);
            }
            :root:not([data-theme="light"]) .row--cta .arrow {
                background: rgba(255, 255, 255, 0.92);
                color: #0b1220;
            }
            :root[data-theme="light"] .row--cta .arrow {
                background: rgba(255, 255, 255, 0.92);
                color: #0b1220;
            }

            /* ховер/нажатие как у остальных кнопок */
            .row--cta:hover {
                filter: saturate(1.05);
                transform: translateY(-2px);
            }
            .row--cta:active {
                filter: brightness(0.98);
                transform: translateY(0) scale(0.99);
            }
            /* прячем верхнюю кнопку "Полный рейтинг" в секции #top */
            #top .topbar-btn {
                display: none;
            }
            /* CTA внизу рейтинга — в стилистике списка */
            .row--cta {
                /* как обычная строка */
                display: grid;
                grid-template-columns: 1fr;
                align-items: center;
                justify-items: center;
                gap: 0;
                padding: 12px 14px; /* как у .row */
                min-height: 72px; /* ~высота строки с бейджами */
                border-top: 1px solid var(--border);
                background: transparent; /* без заливки-полосы */
                max-height: 81px;
            }

            /* внутренняя "кнопка" */
            .row--cta .chip {
                display: inline-flex;
                align-items: center;
                gap: 10px;
                padding: 12px 18px;
                border-radius: 999px;
                font-weight: 900;
                letter-spacing: 0.01em;
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                color: #0b1220;
                box-shadow: 0 10px 22px rgba(0, 0, 0, 0.16),
                    inset 0 1px 0 rgba(255, 255, 255, 0.55);
                transition: transform 0.15s ease, filter 0.15s ease,
                    box-shadow 0.15s ease;
            }

            /* кружок со стрелкой — как у "Все турниры" */
            .row--cta .arrow {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                display: grid;
                place-items: center;
                flex: 0 0 auto;
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6),
                    0 2px 8px rgba(0, 0, 0, 0.18);
            }
            :root:not([data-theme="light"]) .row--cta .arrow {
                background: rgba(255, 255, 255, 0.92);
                color: #0b1220;
            }
            :root[data-theme="light"] .row--cta .arrow {
                background: rgba(255, 255, 255, 0.92);
                color: #0b1220;
            }

            /* ховер/нажатие — такие же жесты, как у остальных кнопок */
            .row--cta:hover .chip {
                transform: translateY(-2px);
                filter: saturate(1.05);
                box-shadow: 0 14px 30px rgba(0, 0, 0, 0.22),
                    inset 0 1px 0 rgba(255, 255, 255, 0.55);
            }
            .row--cta:active .chip {
                transform: translateY(0) scale(0.99);
                filter: brightness(0.98);
            }

            /* безопасность для маленьких экранов — пусть "пилюля" не выходит за края */
            @media (max-width: 480px) {
                .row--cta .chip {
                    width: 100%;
                    justify-content: center;
                }
            }
            /* не двигаем всю строку CTA */
            .row--cta,
            .row--cta:hover,
            .row--cta:active {
                transform: none !important;
            }

            /* анимация только у самой кнопки внутри */
            .row--cta .chip {
                transition: transform 0.15s ease, filter 0.15s ease,
                    box-shadow 0.15s ease;
                will-change: transform;
            }
            .row--cta:hover .chip {
                transform: translateY(-2px);
                filter: saturate(1.05);
                box-shadow: 0 14px 30px rgba(0, 0, 0, 0.22),
                    inset 0 1px 0 rgba(255, 255, 255, 0.55);
            }
            .row--cta:active .chip {
                transform: translateY(0) scale(0.99);
                filter: brightness(0.98);
            }

            /* ===== Qubit extras: modals/forms/checkbox/links/disabled/eyes & drawer flash fix ===== */
            :root {
                --field-bg-dark: rgba(255, 255, 255, 0.08);
                --field-bg-light: rgba(255, 255, 255, 0.78);
                --field-br: 12px;
                --ring: color-mix(in oklab, #fff 75%, var(--accent-to));
            }

            /* Drawer flash fix: overlay below panel, panel no fade */
            .drawer__backdrop {
                z-index: 1;
                opacity: 0;
                transition: opacity 0.22s ease;
            }
            .drawer__panel {
                z-index: 2;
                opacity: 1;
                transition: transform 0.34s var(--tr-open, ease);
            }
            .drawer--open .drawer__backdrop {
                opacity: 0.5;
            }
            .drawer--open .drawer__panel {
                transform: translateX(0);
            }

            /* Modal panel: only slide, no initial dim */
            .modal__panel {
                opacity: 1;
                transition: transform 0.28s var(--tr-open, ease);
            }
            .modal .modal__panel {
                transform: translateY(16px);
            }
            .modal--open .modal__panel {
                transform: translateY(0);
            }

            /* Forms */
            .modal__form {
                display: grid;
                gap: 12px;
            }
            .field {
                display: grid;
                gap: 6px;
            }
            .field label {
                font-size: 13px;
                color: var(--fg-muted);
            }
            .input,
            .textarea {
                width: 100%;
                padding: 12px 14px;
                border-radius: var(--field-br);
                border: 1px solid var(--border);
                color: var(--fg);
                background: var(--field-bg-dark);
                outline: none;
                transition: box-shadow 0.15s ease, border-color 0.15s ease,
                    background 0.15s ease;
            }
            :root[data-theme="light"] .input,
            :root[data-theme="light"] .textarea {
                background: var(--field-bg-light);
                border-color: rgba(0, 0, 0, 0.08);
            }
            .input::placeholder {
                color: color-mix(in oklab, var(--fg), #fff 30%);
                opacity: 0.85;
            }
            :root[data-theme="light"] .input::placeholder {
                color: color-mix(in oklab, var(--fg), #000 20%);
            }
            .input:focus {
                box-shadow: 0 0 0 3px var(--ring);
                border-color: transparent;
            }
            .error {
                font-size: 12px;
                color: #fecaca;
                min-height: 1em;
            }
            :root[data-theme="light"] .error {
                color: #b91c1c;
            }

            /* Checkbox with gradient */
            .checkbox {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 13px;
                color: var(--fg);
            }
            .checkbox input {
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                width: 22px;
                height: 22px;
                border-radius: 6px;
                border: 1px solid var(--border);
                background: var(--muted);
                display: grid;
                place-items: center;
                outline: none;
                cursor: pointer;
                transition: filter 0.15s ease, border-color 0.15s ease,
                    background 0.15s ease, transform 0.15s ease;
            }
            .checkbox input:active {
                transform: scale(0.98);
            }
            .checkbox input:checked {
                border-color: transparent;
                background-image: linear-gradient(
                    135deg,
                    var(--accent-from),
                    var(--accent-to)
                );
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
            }
            .checkbox input:checked::after {
                content: "";
                width: 12px;
                height: 12px;
                border-radius: 3px;
                background: rgba(0, 0, 0, 0.18);
                -webkit-mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>')
                    center/contain no-repeat;
                mask: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>')
                    center/contain no-repeat;
            }

            /* Buttons disabled (grey) until valid */
            .btn.is-disabled,
            .btn:disabled {
                filter: none;
                background: var(--muted) !important;
                color: color-mix(in oklab, var(--fg), #000 15%);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    0 0 0 transparent !important;
                cursor: not-allowed;
            }

            /* Links row — компактные текстовые */
            .form__links {
                display: flex;
                gap: 14px;
                flex-wrap: wrap;
                align-items: center;
                margin-top: 10px;
                font-size: 13px;
            }
            .form__links a {
                color: color-mix(in oklab, var(--fg), #fff 8%);
                text-decoration: none;
            }
            .form__links a:hover {
                color: var(--fg-strong);
                text-decoration: underline;
            }

            /* Password visibility toggle */
            .input-group {
                position: relative;
            }
            .input-toggle {
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                width: 34px;
                height: 34px;
                border-radius: 10px;
                display: grid;
                place-items: center;
                background: var(--muted);
                border: 1px solid var(--border);
                color: var(--fg);
            }
            .input-toggle svg {
                display: block;
            }
            .input-toggle:hover {
                filter: brightness(1.05);
            }
            .input-toggle:active {
                transform: translateY(-50%) scale(0.98);
            }

            /* Code inputs 8x (XXXX-XXXX) */
            .code-grid {
                display: grid;
                grid-template-columns: repeat(4, 42px) 24px repeat(4, 42px);
                gap: 8px;
                align-items: center;
                justify-content: center;
            }
            .code-cell {
                width: 42px;
                height: 48px;
                text-align: center;
                font: 800 20px/48px system-ui, -apple-system, Segoe UI, Roboto,
                    Arial;
                letter-spacing: 0.02em;
            }
            .code-sep {
                text-align: center;
                color: var(--fg-muted);
                user-select: none;
            }
            @media (max-width: 420px) {
                .code-grid {
                    grid-template-columns: repeat(4, 36px) 18px repeat(4, 36px);
                    gap: 6px;
                }
                .code-cell {
                    width: 36px;
                    height: 44px;
                    line-height: 44px;
                }
            }
            /* ===== PATCH • 2025-10-05 ===== */

            /* (A) Стрелка в градиентных кнопках (например, "Полный рейтинг") — всегда белая */
            .btn--accent svg,
            .btn--accent svg path {
                color: #fff;
                stroke: #fff;
                fill: #fff;
            }

            /* (B) Меню/модалки: панель не мерцает, появляется яркой сразу */
            .drawer__backdrop {
                z-index: 1;
                opacity: 0;
                transition: opacity 0.22s ease;
            }
            .drawer__panel {
                z-index: 2;
                opacity: 1;
                transition: transform 0.34s ease;
            }
            .drawer--open .drawer__backdrop {
                opacity: 0.5;
            }
            .drawer--open .drawer__panel {
                transform: translateX(0);
            }

            .modal__panel {
                box-sizing: border-box;
                padding: 16px 18px;
                max-width: min(560px, 96vw);
            }
            #codeModal .modal__panel {
                max-width: min(600px, 96vw);
            }
            .modal .modal__panel {
                transform: translateY(16px);
            }
            .modal--open .modal__panel {
                transform: translateY(0);
            }

            /* (C) Выровнять "глаз" у полей пароля + зарезервировать место */
            .field.input-group {
                display: grid;
                grid-template-columns: 1fr auto;
                grid-template-rows: auto auto;
                align-items: center;
            }
            .field.input-group label {
                grid-column: 1 / -1;
            }
            .field.input-group .input {
                grid-row: 2;
                grid-column: 1;
                padding-right: 10px;
            }
            .field.input-group .input-toggle {
                grid-row: 2;
                grid-column: 2;
                position: static;
                transform: none;
                margin-left: 8px;
                width: 34px;
                height: 34px;
                border-radius: 10px;
                display: grid;
                place-items: center;
                background: var(--muted);
                border: 1px solid var(--border);
                color: var(--fg);
            }
            .input-toggle:hover {
                filter: brightness(1.05);
            }
            .input-toggle:active {
                transform: scale(0.98);
            }
            /* Состояние "закрыт" — добавляем диагональную черту */
            .input-toggle.line::after {
                content: "";
                width: 18px;
                height: 2px;
                background: currentColor;
                transform: rotate(-32deg);
            }

            /* (D) Пояснения об ошибках под полями паролей */
            .field [data-error-for="pass"],
            .field [data-error-for="pass2"] {
                margin-top: 4px;
            }

            /* (E) Код: решаем паддинг справа и мобильную адаптацию */
            .code-grid {
                justify-content: center;
            } /* центрируем весь набор */
            @media (max-width: 420px) {
                .code-grid {
                    grid-template-columns: repeat(4, 36px) 18px repeat(4, 36px);
                    gap: 6px;
                }
                .code-cell {
                    width: 36px;
                    height: 44px;
                    line-height: 44px;
                }
            }
            @media (max-width: 370px) {
                .modal__panel {
                    width: 94vw;
                    padding: 14px;
                } /* симметричные отступы на узких экранах */
                .code-grid {
                    grid-template-columns: repeat(4, 34px) 14px repeat(4, 34px);
                    gap: 6px;
                }
                .code-cell {
                    width: 34px;
                    height: 40px;
                    line-height: 40px;
                }
            }

            /* (F) Кнопки по умолчанию серые (когда disabled) */
            .btn.is-disabled,
            .btn:disabled {
                filter: none;
                background: var(--muted) !important;
                color: color-mix(in oklab, var(--fg), #000 15%);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    0 0 0 transparent !important;
                cursor: not-allowed;
            }

            /* (G) Ссылки под формами — меньше и аккуратнее */
            .form__links {
                display: flex;
                gap: 14px;
                flex-wrap: wrap;
                align-items: center;
                margin-top: 10px;
                font-size: 13px;
            }
            .form__links a {
                color: color-mix(in oklab, var(--fg), #fff 8%);
                text-decoration: none;
            }
            .form__links a:hover {
                color: var(--fg-strong);
                text-decoration: underline;
            }
            /* ===== PATCH • 2025-10-05 ===== */

            /* Стрелка в градиентных кнопках (например, “Полный рейтинг”) — белая */
            .btn--accent svg,
            .btn--accent svg path {
                color: #fff;
                stroke: #fff;
                fill: #fff;
            }

            /* Панель меню/модалок — появляется яркой сразу, без тёмной вспышки */
            .drawer__backdrop {
                z-index: 1;
                opacity: 0;
                transition: opacity 0.22s ease;
            }
            .drawer__panel {
                z-index: 2;
                opacity: 1;
                transition: transform 0.34s ease;
            }
            .drawer--open .drawer__backdrop {
                opacity: 0.5;
            }
            .drawer--open .drawer__panel {
                transform: translateX(0);
            }
            .modal__panel {
                box-sizing: border-box;
                padding: 16px 18px;
                max-width: min(560px, 96vw);
            }
            #codeModal .modal__panel {
                max-width: min(600px, 96vw);
            }
            .modal .modal__panel {
                transform: translateY(16px);
            }
            .modal--open .modal__panel {
                transform: translateY(0);
            }

            /* Выровненный глаз + место под него */
            .field.input-group {
                display: grid;
                grid-template-columns: 1fr auto;
                grid-template-rows: auto auto;
                align-items: center;
            }
            .field.input-group label {
                grid-column: 1 / -1;
            }
            .field.input-group .input {
                grid-row: 2;
                grid-column: 1;
                padding-right: 10px;
            }
            .field.input-group .input-toggle {
                grid-row: 2;
                grid-column: 2;
                position: static;
                transform: none;
                margin-left: 8px;
                width: 34px;
                height: 34px;
                border-radius: 10px;
                display: grid;
                place-items: center;
                background: var(--muted);
                border: 1px solid var(--border);
                color: var(--fg);
            }
            .input-toggle svg {
                transition: transform 0.12s ease, opacity 0.12s ease;
            }
            .input-toggle:hover {
                filter: brightness(1.05);
            }
            .input-toggle:active {
                transform: scale(0.98);
            }

            /* Сообщения об ошибках под паролями */
            .field [data-error-for="pass"],
            .field [data-error-for="pass2"] {
                margin-top: 4px;
            }

            /* Код: центрирование + мобильная адаптация (350px ок) */
            .code-grid {
                justify-content: center;
            }
            @media (max-width: 420px) {
                .code-grid {
                    grid-template-columns: repeat(4, 36px) 18px repeat(4, 36px);
                    gap: 6px;
                }
                .code-cell {
                    width: 36px;
                    height: 44px;
                    line-height: 44px;
                }
            }
            @media (max-width: 370px) {
                .modal__panel {
                    width: 94vw;
                    padding: 14px;
                }
                .code-grid {
                    grid-template-columns: repeat(4, 34px) 14px repeat(4, 34px);
                    gap: 6px;
                }
                .code-cell {
                    width: 34px;
                    height: 40px;
                    line-height: 40px;
                }
            }

            /* Кнопки неактивны (серые), пока форма не валидна */
            .btn.is-disabled,
            .btn:disabled {
                filter: none;
                background: var(--muted) !important;
                color: color-mix(in oklab, var(--fg), #000 15%);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    0 0 0 transparent !important;
                cursor: not-allowed;
            }

            /* Компактные ссылки под формами */
            .form__links {
                display: flex;
                gap: 14px;
                flex-wrap: wrap;
                align-items: center;
                margin-top: 10px;
                font-size: 13px;
            }
            .form__links a {
                color: color-mix(in oklab, var(--fg), #fff 8%);
                text-decoration: none;
            }
            .form__links a:hover {
                color: var(--fg-strong);
                text-decoration: underline;
            }

            /* ===== FIX v3 — 2025‑10‑05 ===== */

            /* Белая стрелка внутри любых градиентных кнопок */
            .btn--accent svg,
            .btn--accent svg path {
                color: #fff;
                stroke: #fff;
                fill: #fff;
            }

            /* Глазик в одной сетке с полем — не «едет», легко кликается */
            .field.input-group {
                display: grid;
                grid-template-columns: 1fr auto;
                grid-template-rows: auto auto;
                align-items: center;
            }
            .field.input-group label {
                grid-column: 1 / -1;
            }
            .field.input-group .input {
                grid-row: 2;
                grid-column: 1;
                padding-right: 12px;
            }
            .field.input-group .input-toggle {
                grid-row: 2;
                grid-column: 2;
                position: static;
                transform: none;
                margin-left: 8px;
                width: 34px;
                height: 34px;
                border-radius: 10px;
                display: grid;
                place-items: center;
                background: var(--muted);
                border: 1px solid var(--border);
                color: var(--fg);
            }
            .input-toggle svg {
                display: block;
                transition: transform 0.12s ease, opacity 0.12s ease;
            }
            .input-toggle:hover {
                filter: brightness(1.05);
            }
            .input-toggle:active {
                transform: scale(0.98);
            }

            /* Подписи об ошибках под паролями */
            .field [data-error-for="pass"],
            .field [data-error-for="pass2"] {
                margin-top: 4px;
                min-height: 1em;
            }

            /* Кнопки по умолчанию серые (disabled) */
            .btn.is-disabled,
            .btn:disabled {
                filter: none;
                background: var(--muted) !important;
                color: color-mix(in oklab, var(--fg), #000 15%);
                box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),
                    0 0 0 transparent !important;
                cursor: not-allowed;
            }

            /* Модалки: панель без «вспышки» затемнения, только слайд */
            .modal .modal__panel {
                transform: translateY(14px);
                opacity: 1;
            }
            .modal--open .modal__panel {
                transform: translateY(0);
            }

            /* Вход по коду — не вылезает ни текст, ни кнопка */
            #codeModal .modal__panel {
                max-width: min(600px, 96vw);
                padding: 16px 18px;
            }
            .code-grid {
                justify-content: center;
            }
            @media (max-width: 400px) {
                #codeModal .modal__panel {
                    width: 96vw;
                    padding: 12px;
                }
                .code-grid {
                    grid-template-columns: repeat(4, 32px) 12px repeat(4, 32px);
                    gap: 6px;
                }
                .code-cell {
                    width: 32px;
                    height: 38px;
                    line-height: 38px;
                    font-size: 18px;
                }
            }
            @media (max-width: 350px) {
                #codeModal .modal__panel {
                    width: 96vw;
                    padding: 10px;
                }
                .code-grid {
                    grid-template-columns: repeat(4, 30px) 10px repeat(4, 30px);
                    gap: 5px;
                }
                .code-cell {
                    width: 30px;
                    height: 36px;
                    line-height: 36px;
                    font-size: 17px;
                }
            }

            /* Drag‑scroll для карусели + без выделения текста при перетаскивании */
            .hscroll {
                cursor: grab;
                user-select: none;
                -webkit-user-drag: none;
            }
            .hscroll.dragging {
                cursor: grabbing;
            }
            .hscroll * {
                user-select: none;
                -webkit-user-drag: none;
            }
        </style>
    </head>

    <body>
        <div class="grid" aria-hidden="true"></div>

        <header class="header">
            <div class="container header__inner">
                <a href="#" class="brand" aria-label="На главную">
                    <span class="brand__chip">Q</span>
                    <span class="brand__text">Qubit</span>
                </a>
                <div class="header__actions">
                    <button
                        class="btn btn--icon-only"
                        id="themeToggle"
                        aria-label="Сменить тему"
                        aria-pressed="false"
                        title="Тема"
                    >
                        <!-- луна (тёмная) -->
                        <svg
                            class="moon"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                                fill="currentColor"
                            />
                        </svg>
                        <!-- солнце (светлая) -->
                        <svg
                            class="sun"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5 5L4 4m16 16-1-1M19 5l1-1M5 19l-1 1"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                            <circle cx="12" cy="12" r="4" fill="currentColor" />
                        </svg>
                    </button>
                    <button
                        class="btn btn--icon-only"
                        id="burger"
                        aria-label="Открыть меню"
                        aria-controls="drawer"
                        aria-expanded="false"
                    >
                        <svg
                            width="22"
                            height="22"
                            viewBox="0 0 24 24"
                            class="i"
                        >
                            <path
                                d="M4 6h16M4 12h16M4 18h16"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Drawer -->
        <div id="drawer" class="drawer" hidden>
            <div
                class="drawer__panel"
                role="dialog"
                aria-modal="true"
                aria-label="Меню"
            >
                <div class="drawer__top">
                    <div class="drawer__usercard">
                        <div class="avatar avatar--ring">U</div>
                        <div class="user-meta">
                            <div class="user-name">Гость</div>
                            <div class="user-role">Не авторизован</div>
                        </div>
                    </div>

                    <!-- иконка темы, как в хедере -->
                    <button
                        class="btn btn--icon-only"
                        id="themeToggleDrawerIcon"
                        aria-label="Сменить тему"
                        aria-pressed="false"
                        title="Тема"
                    >
                        <svg
                            class="moon"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                                fill="currentColor"
                            />
                        </svg>
                        <svg
                            class="sun"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5 5L4 4m16 16-1-1M19 5l1-1M5 19l-1 1"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                            <circle cx="12" cy="12" r="4" fill="currentColor" />
                        </svg>
                    </button>

                    <!-- крестик строго справа -->
                    <button
                        class="btn btn--icon-only drawer__close"
                        id="drawerClose"
                        aria-label="Закрыть"
                    >
                        <svg width="20" height="20" viewBox="0 0 24 24">
                            <path
                                d="M18 6L6 18M6 6l12 12"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>

                <nav
                    class="drawer__nav"
                    id="drawerNav"
                    style="flex: 1; overflow: auto"
                >
                    <div class="drawer__group">
                        <div class="drawer__label">Навигация</div>

                        <a href="#what" class="drawer__item">
                            <div class="left">
                                <span class="ico"
                                    ><svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm0 6v2m0 3v5"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            fill="none"
                                            stroke-linecap="round"
                                        /></svg
                                ></span>
                                <span>Что за игра</span>
                            </div>
                            <svg
                                class="chev"
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M9 6l6 6-6 6"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    fill="none"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                        </a>

                        <a href="#tournaments" class="drawer__item">
                            <div class="left">
                                <span class="ico"
                                    ><svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M8 4h8v3h3v3a7 7 0 0 1-7 7 7 7 0 0 1-7-7V7h3V4z"
                                            fill="currentColor"
                                        /></svg
                                ></span>
                                <span>Турниры</span>
                            </div>
                            <svg
                                class="chev"
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M9 6l6 6-6 6"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    fill="none"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                        </a>

                        <a href="#top" class="drawer__item">
                            <div class="left">
                                <span class="ico"
                                    ><svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M4 14h4v6H4zM10 10h4v10h-4zM16 6h4v14h-4z"
                                            fill="currentColor"
                                        /></svg
                                ></span>
                                <span>Рейтинг</span>
                            </div>
                            <svg
                                class="chev"
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M9 6l6 6-6 6"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    fill="none"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                        </a>

                        <a href="#footer" class="drawer__item">
                            <div class="left">
                                <span class="ico"
                                    ><svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8z"
                                            fill="currentColor"
                                        /></svg
                                ></span>
                                <span>Контакты</span>
                            </div>
                            <svg
                                class="chev"
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M9 6l6 6-6 6"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    fill="none"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                />
                            </svg>
                        </a>
                    </div>
                </nav>

                <div class="drawer__actions">
                    <button class="btn btn--accent btn--block" id="drawerLogin">
                        Войти
                    </button>
                    <button
                        class="btn btn--muted btn--block"
                        id="themeToggleDrawer"
                        data-role="theme-btn"
                    >
                        Светлая тема
                    </button>
                </div>
            </div>
            <div class="drawer__backdrop" id="drawerBackdrop"></div>
        </div>

        <!-- Right-side dots -->
        <aside class="side-nav" aria-label="Боковое меню">
            <a href="#hero" class="side-nav__dot" data-label="Начало"></a>
            <a href="#what" class="side-nav__dot" data-label="Что за игра"></a>
            <a
                href="#tournaments"
                class="side-nav__dot"
                data-label="Турниры"
            ></a>
            <a href="#top" class="side-nav__dot" data-label="Топ игроков"></a>
            <a href="#footer" class="side-nav__dot" data-label="Футер"></a>
        </aside>

        <main>
            <!-- HERO -->
            <section id="hero" class="hero">
                <div class="hero__stage">
                    <div class="formulas" aria-hidden="true">
                        <span class="f1">S = πr²</span
                        ><span class="f2">a² + b² = c²</span
                        ><span class="f3">F = ma</span>
                        <span class="f4">∑ i=1..n i = n(n+1)/2</span
                        ><span class="f5">e^{iπ}+1=0</span>
                        <span class="f6">P(A∩B)=P(A)·P(B)</span
                        ><span class="f7">lg a + lg b = lg(ab)</span>
                        <span class="f8">lim_{x→0} sin x / x = 1</span
                        ><span class="f9">d/dx (x^n) = n·x^{n-1}</span>
                        <span class="f10">∫ e^x dx = e^x + C</span>
                    </div>
                    <div class="hero__inner">
                        <div class="word" id="word">QUBIT</div>
                        <div class="tagline">
                            Бей рекорды — счёт идёт на секунды
                        </div>
                        <div class="hero__cta">
                            <button
                                id="openLogin"
                                class="btn btn--accent btn--hero"
                                style="min-width: 220px"
                            >
                                Войти
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- WHAT -->
            <section id="what" class="section">
                <div class="container">
                    <div class="kicker" data-reveal>Что за игра</div>
                    <h2 class="what__title" data-reveal>
                        Qubit — турнир на скорость и логику
                    </h2>
                    <div class="accent-bar" data-reveal></div>
                    <p class="lead" data-reveal>
                        Игра идёт раундами. В каждом
                        <strong>таймер</strong> запускается, участники отвечают
                        на задачи, а очки начисляются за скорость и точность.
                        Ведущий управляет этапами, а зрители видят общий
                        прогресс.
                    </p>

                    <div class="feature-card" data-reveal>
                        <div class="feature-card__icon"></div>
                        <div>
                            <div class="feature-card__title">
                                Быстрые раунды
                            </div>
                            <div class="feature-card__sub">
                                30–90 секунд на задачу — не зевай
                            </div>
                        </div>
                    </div>
                    <div class="feature-card" data-reveal>
                        <div class="feature-card__icon"></div>
                        <div>
                            <div class="feature-card__title">
                                Честная схватка
                            </div>
                            <div class="feature-card__sub">
                                Единые правила, авто-проверка ответов
                            </div>
                        </div>
                    </div>
                    <div class="feature-card" data-reveal>
                        <div class="feature-card__icon"></div>
                        <div>
                            <div class="feature-card__title">Живое табло</div>
                            <div class="feature-card__sub">
                                Рейтинги, серии побед и награды
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TOURNAMENTS -->
            <section id="tournaments" class="section">
                <div class="container">
                    <div class="kicker" data-reveal>Турниры</div>
                    <div style="display: flex; align-items: center; gap: 10px">
                        <h2 class="section__title" data-reveal>
                            Текущие и ближайшие
                        </h2>
                    </div>
                    <div class="accent-bar" data-reveal></div>

                    <div class="hscroll-wrap" data-reveal="fade">
                        <div class="hscroll__controls">
                            <button
                                class="btn btn--muted"
                                id="hsLeft"
                                aria-label="Прокрутить влево"
                            >
                                ←
                            </button>
                            <button
                                class="btn btn--accent"
                                id="hsRight"
                                aria-label="Прокрутить вправо"
                            >
                                →
                            </button>
                        </div>
                        <div class="hscroll" id="hscroll">
                            <article class="card">
                                <div class="card__topbar"></div>
                                <div class="card__head">
                                    <span class="status status--soon"
                                        ><span class="dot"></span>Скоро</span
                                    ><span class="meta">01 окт, 20:00</span>
                                </div>
                                <h3 class="card__title">Осенняя рубка #12</h3>
                                <p class="card__sub">Микс задач</p>
                                <div class="card__meta">
                                    <span class="meta">28 игроков</span
                                    ><span class="meta">5 раундов</span>
                                </div>
                                <div class="card__actions">
                                    <a href="#" class="btn btn--muted"
                                        >Открыть</a
                                    ><button class="btn btn--accent">
                                        Присоединиться
                                    </button>
                                </div>
                            </article>
                            <article class="card">
                                <div class="card__topbar"></div>
                                <div class="card__head">
                                    <span class="status status--live"
                                        ><span class="dot"></span>В эфире</span
                                    ><span class="meta">Сегодня</span>
                                </div>
                                <h3 class="card__title">Спринт 30</h3>
                                <p class="card__sub">Блиц</p>
                                <div class="card__meta">
                                    <span class="meta">18 игроков</span
                                    ><span class="meta">3 раунда</span>
                                </div>
                                <div class="card__actions">
                                    <a href="#" class="btn btn--muted"
                                        >Открыть</a
                                    ><button class="btn btn--accent">
                                        Присоединиться
                                    </button>
                                </div>
                            </article>
                            <article class="card">
                                <div class="card__topbar"></div>
                                <div class="card__head">
                                    <span class="status status--ended"
                                        ><span class="dot"></span>Завершён</span
                                    ><span class="meta">27 сен, 18:00</span>
                                </div>
                                <h3 class="card__title">Логические загадки</h3>
                                <p class="card__sub">Комбинаторика</p>
                                <div class="card__meta">
                                    <span class="meta">40 игроков</span
                                    ><span class="meta">4 раунда</span>
                                </div>
                                <div class="card__actions">
                                    <a href="#" class="btn btn--muted"
                                        >Открыть</a
                                    >
                                </div>
                            </article>
                            <article class="card">
                                <div class="card__topbar"></div>
                                <div class="card__head">
                                    <span class="status status--soon"
                                        ><span class="dot"></span>Скоро</span
                                    ><span class="meta">03 окт, 17:00</span>
                                </div>
                                <h3 class="card__title">Командная заруба</h3>
                                <p class="card__sub">Логика + скорость</p>
                                <div class="card__meta">
                                    <span class="meta">22 игрока</span
                                    ><span class="meta">4 раунда</span>
                                </div>
                                <div class="card__actions">
                                    <a href="#" class="btn btn--muted"
                                        >Открыть</a
                                    ><button class="btn btn--accent">
                                        Присоединиться
                                    </button>
                                </div>
                            </article>
                            <a
                                class="card card--all"
                                href="#"
                                aria-label="Все турниры"
                            >
                                <div class="card__topbar"></div>
                                <span class="label">Все турниры</span>
                                <span class="arrow" aria-hidden="true">
                                    <svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M5 12h14M13 5l7 7-7 7"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            fill="none"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        />
                                    </svg>
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TOP players -->
            <section id="top" class="section">
                <div class="container">
                    <div class="kicker" data-reveal>Рейтинг</div>
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            gap: 12px;
                            justify-content: space-between;
                        "
                    >
                        <h2 class="section__title" data-reveal>Топ игроков</h2>
                        <a href="#" class="topbar-btn" data-reveal
                            >Полный рейтинг</a
                        >
                    </div>
                    <div class="accent-bar" data-reveal></div>

                    <div class="board" data-reveal>
                        <div class="row">
                            <div class="rankchip rankchip--1">1</div>
                            <div class="badge">N</div>
                            <div class="row__mid">
                                <div class="row__name">Neo</div>
                                <div class="row__sub">Серия: 4</div>
                            </div>
                            <div class="row__right">
                                <div class="score">1980 RP</div>
                                <div class="wins">Побед: 12</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="rankchip rankchip--2">2</div>
                            <div class="badge">A</div>
                            <div class="row__mid">
                                <div class="row__name">Astra</div>
                                <div class="row__sub">Серия: 2</div>
                            </div>
                            <div class="row__right">
                                <div class="score">1765 RP</div>
                                <div class="wins">Побед: 9</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="rankchip rankchip--3">3</div>
                            <div class="badge">Z</div>
                            <div class="row__mid">
                                <div class="row__name">Zed</div>
                                <div class="row__sub">Серия: 1</div>
                            </div>
                            <div class="row__right">
                                <div class="score">1702 RP</div>
                                <div class="wins">Побед: 8</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="rankchip rankchip--n">4</div>
                            <div class="badge">DL</div>
                            <div class="row__mid">
                                <div class="row__name">dlex</div>
                                <div class="row__sub">&nbsp;</div>
                            </div>
                            <div class="row__right">
                                <div class="score">1640 RP</div>
                                <div class="wins">Побед: 7</div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="rankchip rankchip--n">5</div>
                            <div class="badge">YA</div>
                            <div class="row__mid">
                                <div class="row__name">yarik</div>
                                <div class="row__sub">&nbsp;</div>
                            </div>
                            <div class="row__right">
                                <div class="score">1594 RP</div>
                                <div class="wins">Побед: 5</div>
                            </div>
                        </div>
                        <a
                            class="row row--cta"
                            href="#"
                            aria-label="Полный рейтинг"
                        >
                            <span class="chip">
                                <span class="label">Полный рейтинг</span>
                                <span class="arrow" aria-hidden="true">
                                    <svg
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            d="M5 12h14M13 5l7 7-7 7"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            fill="none"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        />
                                    </svg>
                                </span>
                            </span>
                        </a>
                    </div>
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer id="footer" class="footer">
            <div class="container footer__grid">
                <div>
                    <div class="footer__brand">Qubit</div>
                    <p class="footer__text">
                        Платформа турниров в реальном времени. Учись быстро
                        думать и выигрывать честно.
                    </p>
                    <div class="footer__links">
                        <a href="#" class="footer__link">О проекте</a>
                        <a href="#" class="footer__link">Турниры</a>
                        <a href="#" class="footer__link">Правила</a>
                        <a href="#" class="footer__link">Рейтинг</a>
                        <a href="#" class="footer__link">Контакты</a>
                        <a href="#" class="footer__link">Конфиденциальность</a>
                    </div>
                    <div class="footer__copy">
                        © 2025 Qubit. Все права защищены.
                    </div>
                </div>
            </div>
        </footer>

        <!-- Login Modal -->
        <div id="loginModal" class="modal" hidden>
            <div class="modal__backdrop" id="modalBackdrop"></div>
            <div
                class="modal__panel"
                role="dialog"
                aria-modal="true"
                aria-labelledby="modalTitle"
            >
                <div class="modal__head">
                    <div id="modalTitle" class="modal__title">
                        Войти в Qubit
                    </div>
                    <button
                        class="modal__close"
                        id="modalClose"
                        aria-label="Закрыть"
                    >
                        <svg
                            width="22"
                            height="22"
                            viewBox="0 0 24 24"
                            class="i"
                        >
                            <path
                                d="M18 6L6 18M6 6l12 12"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                            />
                        </svg>
                    </button>
                </div>
                <div class="modal__body">
                    <button
                        class="btn btn--accent"
                        style="justify-content: center"
                    >
                        Войти по коду
                    </button>
                    <button
                        class="btn btn--muted"
                        style="justify-content: center"
                    >
                        Войти по логину
                    </button>
                    <button
                        class="btn btn--muted"
                        style="justify-content: center"
                    >
                        Зарегистрироваться
                    </button>
                </div>
            </div>
        </div>

        <script>
            /* ТЕМА: загрузка предпочтения, переключение и сохранение */
            const themeToggle = document.getElementById("themeToggle");

            function getPreferredTheme() {
                const saved = localStorage.getItem("theme");
                if (saved === "light" || saved === "dark") return saved;
                return window.matchMedia &&
                    window.matchMedia("(prefers-color-scheme: light)").matches
                    ? "light"
                    : "dark";
            }
            function setTheme(t) {
                document.documentElement.setAttribute("data-theme", t);
                localStorage.setItem("theme", t);
                themeToggle?.setAttribute("aria-pressed", t === "light");
            }
            document.addEventListener("DOMContentLoaded", () =>
                setTheme(getPreferredTheme())
            );

            themeToggle?.addEventListener("click", () => {
                const next =
                    document.documentElement.getAttribute("data-theme") ===
                    "light"
                        ? "dark"
                        : "light";
                setTheme(next);
            });

            /* (необязательно) если пользователь не задавал тему — реагировать на смену системной */
            if (!localStorage.getItem("theme") && window.matchMedia) {
                window
                    .matchMedia("(prefers-color-scheme: light)")
                    .addEventListener("change", (e) => {
                        setTheme(e.matches ? "light" : "dark");
                    });
            }
            /* синхронизация подписи кнопки темы в меню */
            function updateThemeButtons() {
                const t =
                    document.documentElement.getAttribute("data-theme") ===
                    "light"
                        ? "Тёмная тема"
                        : "Светлая тема";
                document
                    .querySelectorAll('[data-role="theme-btn"]')
                    .forEach((b) => (b.textContent = t));
            }
            document.addEventListener("DOMContentLoaded", updateThemeButtons);

            /* если setTheme уже есть — дополним её вызовом обновления лейбла */
            const __oldSetTheme = window.setTheme;
            window.setTheme = function (t) {
                __oldSetTheme
                    ? __oldSetTheme(t)
                    : document.documentElement.setAttribute("data-theme", t);
                updateThemeButtons();
            };

            /* кнопка темы в меню */
            const themeToggleDrawer =
                document.getElementById("themeToggleDrawer");
            themeToggleDrawer?.addEventListener("click", () => {
                const next =
                    document.documentElement.getAttribute("data-theme") ===
                    "light"
                        ? "dark"
                        : "light";
                setTheme(next);
            });

            /* по клику «Войти» в меню откроем твою модалку входа */
            document
                .getElementById("drawerLogin")
                ?.addEventListener("click", () => {
                    closeDrawer?.(); // закроем меню (ф-ция у тебя уже есть)
                    openModal?.(); // откроем модалку входа
                });
            // Иконка темы в меню
            const themeToggleDrawerIcon = document.getElementById(
                "themeToggleDrawerIcon"
            );
            themeToggleDrawerIcon?.addEventListener("click", () => {
                const next =
                    document.documentElement.getAttribute("data-theme") ===
                    "light"
                        ? "dark"
                        : "light";
                setTheme(next); // используем твою существующую функцию
            });

            // Header padding sync
            function syncHeaderPad() {
                const h = document.querySelector(".header")?.offsetHeight || 56;
                document.documentElement.style.setProperty(
                    "--header-h",
                    h + "px"
                );
                document.body.style.paddingTop = "var(--header-h)";
            }
            window.addEventListener("resize", syncHeaderPad, { passive: true });
            document.addEventListener("DOMContentLoaded", syncHeaderPad);

            // Robust 100vh on mobile
            function setVH() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty("--vh", `${vh}px`);
            }
            window.addEventListener("resize", setVH, { passive: true });
            window.addEventListener("orientationchange", setVH);
            document.addEventListener("DOMContentLoaded", setVH);

            // Drawer
            const drawerClose = document.getElementById("drawerClose");
            const drawerBackdrop = document.getElementById("drawerBackdrop");
            const drawerNav = document.getElementById("drawerNav");
            const drawer = document.getElementById("drawer");
            const panel = drawer?.querySelector(".drawer__panel");
            const burger = document.getElementById("burger");

            function openDrawer() {
                if (!drawer) return;
                drawer.hidden = false;
                // если закрывалось ранее — уберём служебный класс
                drawer.classList.remove("drawer--closing");
                requestAnimationFrame(() =>
                    drawer.classList.add("drawer--open")
                );
                burger?.setAttribute("aria-expanded", "true");
                document.body.style.overflow = "hidden";
            }
            function closeDrawer() {
                if (!drawer) return;
                // меняем состояние на "закрывается"
                drawer.classList.remove("drawer--open");
                drawer.classList.add("drawer--closing");
                burger?.setAttribute("aria-expanded", "false");

                // когда панель доедет — полностью спрячем контейнер
                const onEnd = (e) => {
                    if (e.target !== panel || e.propertyName !== "transform")
                        return;
                    drawer.classList.remove("drawer--closing");
                    drawer.hidden = true;
                    document.body.style.overflow = "";
                    panel.removeEventListener("transitionend", onEnd);
                };
                panel.addEventListener("transitionend", onEnd);
            }

            burger?.addEventListener("click", openDrawer);
            drawerClose?.addEventListener("click", closeDrawer);
            drawerBackdrop?.addEventListener("click", closeDrawer);
            drawerNav?.addEventListener("click", (e) => {
                if (e.target.matches("a")) closeDrawer();
            });
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && drawer && !drawer.hidden)
                    closeDrawer();
            });

            // Side dots active
            const dots = document.querySelectorAll(".side-nav__dot");
            const sections = ["hero", "what", "tournaments", "top", "footer"]
                .map((id) => document.getElementById(id))
                .filter(Boolean);
            const io = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        const id = entry.target.id;
                        const active =
                            entry.isIntersecting &&
                            entry.intersectionRatio > 0.3;
                        const link = [...dots].find(
                            (a) => a.getAttribute("href") === `#${id}`
                        );
                        if (link) link.classList.toggle("active", active);
                    });
                },
                { threshold: [0.3, 0.6] }
            );
            sections.forEach((sec) => io.observe(sec));

            // Reveal on scroll
            const revealEls = document.querySelectorAll("[data-reveal]");
            const ioReveal = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("in");
                            ioReveal.unobserve(entry.target);
                        }
                    });
                },
                { threshold: 0.15, rootMargin: "0px 0px -40px 0px" }
            );
            revealEls.forEach((el) => ioReveal.observe(el));

            // Modal
            const loginModal = document.getElementById("loginModal");
            const modalBackdrop = document.getElementById("modalBackdrop");
            const modalClose = document.getElementById("modalClose");
            const openLogin = document.getElementById("openLogin");
            let lastFocus = null;
            function openModal() {
                lastFocus = document.activeElement;
                loginModal.hidden = false;
                requestAnimationFrame(() =>
                    loginModal.classList.add("modal--open")
                );
                document.body.style.overflow = "hidden";
                const first = loginModal.querySelector(".modal__body .btn");
                first?.focus();
            }
            function closeModal() {
                loginModal.classList.remove("modal--open");
                loginModal.addEventListener(
                    "transitionend",
                    () => {
                        loginModal.hidden = true;
                        document.body.style.overflow = "";
                        lastFocus?.focus();
                    },
                    { once: true }
                );
            }
            openLogin?.addEventListener("click", openModal);
            modalBackdrop?.addEventListener("click", closeModal);
            modalClose?.addEventListener("click", closeModal);
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape" && !loginModal.hidden) closeModal();
                if (e.key === "Tab" && !loginModal.hidden) {
                    const focusables = loginModal.querySelectorAll(
                        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                    );
                    const first = focusables[0],
                        last = focusables[focusables.length - 1];
                    if (e.shiftKey && document.activeElement === first) {
                        last.focus();
                        e.preventDefault();
                    } else if (!e.shiftKey && document.activeElement === last) {
                        first.focus();
                        e.preventDefault();
                    }
                }
            });

            // Horizontal scroll buttons
            const hs = document.getElementById("hscroll");
            const hsLeft = document.getElementById("hsLeft");
            const hsRight = document.getElementById("hsRight");
            hsLeft?.addEventListener(
                "click",
                () =>
                    hs &&
                    hs.scrollBy({
                        left: -hs.clientWidth * 0.9,
                        behavior: "smooth",
                    })
            );
            hsRight?.addEventListener(
                "click",
                () =>
                    hs &&
                    hs.scrollBy({
                        left: hs.clientWidth * 0.9,
                        behavior: "smooth",
                    })
            );

            /* Fit the word to one line */
            function fitWord() {
                const el = document.getElementById("word");
                if (!el) return;
                const parent = el.parentElement;
                const maxW =
                    Math.min(parent.clientWidth, window.innerWidth) - 24;
                const minPx = 48,
                    maxPx = 240;
                el.style.fontSize = maxPx + "px";
                el.style.whiteSpace = "nowrap";
                let w = el.scrollWidth;
                let fs = parseFloat(getComputedStyle(el).fontSize);
                if (w > 0) {
                    const ratio = (maxW * 0.98) / w;
                    const next = Math.max(
                        minPx,
                        Math.min(maxPx, Math.floor(fs * Math.min(1, ratio)))
                    );
                    el.style.fontSize = next + "px";
                }
            }
            window.addEventListener("resize", fitWord, { passive: true });
            window.addEventListener("orientationchange", fitWord);
            document.addEventListener("DOMContentLoaded", () => {
                fitWord();
                setTimeout(fitWord, 50);
            });

            // ===== Qubit extras: modals DOM, validation, disabled buttons, code 8 cells, eyes, persistence, drawer flash fix =====
            (function () {
                if (window.__QUBIT_BUNDLE__) return;
                window.__QUBIT_BUNDLE__ = true;
                const $ = (s, r = document) => r.querySelector(s);
                const $$ = (s, r = document) =>
                    Array.from(r.querySelectorAll(s));

                // Inject modals (без удаления твоего loginModal)
                function mountModals() {
                    const wrap = document.createElement("div");
                    wrap.innerHTML = `
      <!-- Регистрация -->
      <div id="regModal" class="modal" hidden>
        <div class="modal__backdrop" data-close="regModal"></div>
        <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="regTitle">
          <div class="modal__head">
            <div id="regTitle" class="modal__title">Регистрация</div>
            <button class="modal__close" data-close="regModal" aria-label="Закрыть">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
          <form class="modal__form" id="regForm" novalidate>
            <div class="field"><label>Логин</label><input class="input" name="login" placeholder="vasyaSO" data-required><div class="error" data-error-for="login"></div></div>
            <div class="field"><label>Почта</label><input class="input" type="email" name="email" data-required data-type="email"><div class="error" data-error-for="email"></div></div>
            <div class="field input-group"><label>Пароль</label><input class="input" type="password" name="pass" placeholder="********" minlength="8" data-required data-type="passrule"><button type="button" class="input-toggle" aria-label="Показать пароль"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12zm11 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="currentColor"/></svg></button><div class="error" data-error-for="pass"></div></div>
            <div class="field input-group" data-for="pass2"><label>Повторите пароль</label><input class="input" type="password" name="pass2" placeholder="********" data-required data-type="match:pass"><button type="button" class="input-toggle" aria-label="Показать пароль"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12zm11 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="currentColor"/></svg></button><div class="error" data-error-for="pass2"></div></div>
            <label class="checkbox"><input type="checkbox" name="agree" data-required-check><span>Принимаю условия пользовательского соглашения на обработку персональных данных</span></label>
            <div class="error" data-form-error></div>
            <button class="btn btn--accent btn--block is-disabled" type="submit" disabled>Зарегистрироваться</button>
            <div class="form__links"><a href="#" data-open="authModal">Войти в аккаунт</a></div>
          </form>
        </div>
      </div>

      <!-- О себе -->
      <div id="profileModal" class="modal" hidden>
        <div class="modal__backdrop" data-close="profileModal"></div>
        <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="profileTitle">
          <div class="modal__head">
            <div id="profileTitle" class="modal__title">О себе</div>
            <button class="modal__close" data-close="profileModal" aria-label="Закрыть">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
          <form class="modal__form" id="profileForm" novalidate>
            <div class="field"><label>Фамилия</label><input class="input" name="lastName" data-required></div>
            <div class="field"><label>Имя</label><input class="input" name="firstName" data-required></div>
            <div class="field"><label>Отчество</label><input class="input" name="middleName"></div>
            <div class="field"><label>Город</label><input class="input" name="city" data-required></div>
            <div class="field"><label>Место обучения</label><input class="input" name="place" data-required></div>
            <div class="field"><label>Класс/группа/курс</label><input class="input" name="class" data-required></div>
            <div class="error" data-form-error></div>
            <button class="btn btn--accent btn--block is-disabled" type="submit" disabled>Продолжить</button>
          </form>
        </div>
      </div>

      <!-- Авторизация -->
      <div id="authModal" class="modal" hidden>
        <div class="modal__backdrop" data-close="authModal"></div>
        <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="authTitle">
          <div class="modal__head">
            <div id="authTitle" class="modal__title">Авторизация</div>
            <button class="modal__close" data-close="authModal" aria-label="Закрыть">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
          <form class="modal__form" id="authForm" novalidate>
            <div class="field"><label>Логин</label><input class="input" name="login" data-required></div>
            <div class="field input-group"><label>Пароль</label><input class="input" type="password" name="pass" data-required><button type="button" class="input-toggle" aria-label="Показать пароль"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M17.94 17.94A10.7 10.7 0 0 1 12 19c-7 0-11-7-11-7a18.9 18.9 0 0 1 4.19-4.86M7 7a10.7 10.7 0 0 1 5-2c7 0 11 7 11 7a18.9 18.9 0 0 1-4.1 4.75M1 1l22 22" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"></path></svg></button></div>
            <button class="btn btn--accent btn--block is-disabled" type="submit" disabled>Войти</button>
            <div class="form__links">
              <a href="#" data-open="regModal">Создать аккаунт</a>
              <a href="#" data-open="forgotModal">Забыл пароль</a>
            </div>
          </form>
        </div>
      </div>

      <!-- Вход по коду — 8 ячеек -->
      <div id="codeModal" class="modal" hidden>
        <div class="modal__backdrop" data-close="codeModal"></div>
        <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="codeTitle">
          <div class="modal__head">
            <div id="codeTitle" class="modal__title">Вход по коду</div>
            <button class="modal__close" data-close="codeModal" aria-label="Закрыть">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
          <form class="modal__form" id="codeForm" novalidate>
            <div class="code-grid">
              <input class="input code-cell" maxlength="1" inputmode="latin" pattern="[A-Za-z0-9]" autocomplete="one-time-code" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <div class="code-sep">—</div>
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
              <input class="input code-cell" maxlength="1" pattern="[A-Za-z0-9]" />
            </div>
            <input type="hidden" name="code" value="">
            <button class="btn btn--accent btn--block is-disabled" type="submit" disabled>Войти</button>
          </form>
        </div>
      </div>

      <!-- Забыл пароль -->
      <div id="forgotModal" class="modal" hidden>
        <div class="modal__backdrop" data-close="forgotModal"></div>
        <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="forgotTitle">
          <div class="modal__head">
            <div id="forgotTitle" class="modal__title">Восстановление пароля</div>
            <button class="modal__close" data-close="forgotModal" aria-label="Закрыть">
              <svg width="22" height="22" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>
          <form class="modal__form" id="forgotForm" novalidate>
            <div class="field"><label>Почта</label><input class="input" type="email" name="email" placeholder="you@mail.ru" data-required data-type="email"><div class="error" data-error-for="email"></div></div>
            <button class="btn btn--accent btn--block is-disabled" type="submit" disabled>Сбросить пароль</button>
          </form>
        </div>
      </div>
    `;
                    document.body.appendChild(wrap);
                }

                // helpers
                function isValidEmail(v) {
                    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(
                        (v || "").trim()
                    );
                }
                function hasOnlyLatin(s) {
                    return !/[А-Яа-яЁё]/.test(s || "");
                }
                function passRuleOk(s) {
                    return (
                        (s || "").length >= 8 &&
                        hasOnlyLatin(s) &&
                        /[A-Za-z]/.test(s)
                    );
                }

                function updateSubmitState(form) {
                    const submit = form.querySelector('button[type="submit"]');
                    if (!submit) return;
                    let ok = true;

                    form.querySelectorAll("[data-required]").forEach((el) => {
                        if (!(el.value || "").trim()) ok = false;
                    });
                    form.querySelectorAll('[data-type="email"]').forEach(
                        (el) => {
                            if (!isValidEmail(el.value)) ok = false;
                        }
                    );
                    form.querySelectorAll("[data-required-check]").forEach(
                        (ch) => {
                            if (!ch.checked) ok = false;
                        }
                    );
                    const pass = form.querySelector('input[name="pass"]');
                    if (pass && pass.hasAttribute("data-type")) {
                        ok = ok && passRuleOk(pass.value);
                    }
                    const mismatch = form.querySelector(
                        '[data-type^="match:"]'
                    );
                    if (mismatch) {
                        const target = mismatch.dataset.type.split(":")[1];
                        const other = form.querySelector(`[name="${target}"]`);
                        if (other && mismatch.value !== other.value) ok = false;
                    }

                    // code form: require 8 cells
                    if (form.id === "codeForm") {
                        const cells = Array.from(
                            form.querySelectorAll(".code-cell")
                        );
                        const code = cells
                            .map((i) => (i.value || "").trim())
                            .join("");
                        form.querySelector('input[name="code"]').value = code
                            .slice(0, 8)
                            .toUpperCase();
                        if (code.length !== 8) ok = false;
                    }

                    submit.disabled = !ok;
                    submit.classList.toggle("is-disabled", !ok);
                }

                function persistForm(form) {
                    const key = "form:" + (form.id || "noid");
                    try {
                        const data = JSON.parse(
                            localStorage.getItem(key) || "{}"
                        );
                        Object.entries(data).forEach(([name, val]) => {
                            const el = form.elements[name];
                            if (!el) return;
                            if (el.type === "checkbox") el.checked = !!val;
                            else el.value = val;
                        });
                    } catch {}
                    const save = () => {
                        const obj = {};
                        Array.from(form.elements).forEach((el) => {
                            if (el.name)
                                obj[el.name] =
                                    el.type === "checkbox"
                                        ? el.checked
                                        : el.value;
                        });
                        try {
                            localStorage.setItem(key, JSON.stringify(obj));
                        } catch {}
                        updateSubmitState(form);
                    };
                    form.addEventListener("input", save);
                    form.addEventListener("change", save);
                }

                function addEyes(form) {
                    form.querySelectorAll(".input-group .input-toggle").forEach(
                        (btn) => {
                            const inp = btn.parentElement.querySelector(
                                'input[type="password"]'
                            );
                            if (!inp) return;
                            btn.addEventListener("click", () => {
                                inp.type =
                                    inp.type === "password"
                                        ? "text"
                                        : "password";
                            });
                        }
                    );
                }

                function bindErrors(form) {
                    // live mismatch message under pass2
                    const pass2Box = form.querySelector(
                        '[data-error-for="pass2"]'
                    );
                    const pass = form.querySelector('input[name="pass"]');
                    const pass2 = form.querySelector('input[name="pass2"]');
                    const formErr = form.querySelector("[data-form-error]");
                    const setPass2Msg = () => {
                        if (!pass2Box) return;
                        if (
                            (pass2?.value || "") &&
                            pass &&
                            pass2.value !== pass.value
                        )
                            pass2Box.textContent = "Пароли не совпадают";
                        else pass2Box.textContent = "";
                    };
                    pass?.addEventListener("input", setPass2Msg);
                    pass2?.addEventListener("input", setPass2Msg);

                    form.addEventListener("submit", (e) => {
                        if (formErr) formErr.textContent = "";
                        // explicit errors
                        if (
                            pass &&
                            pass.hasAttribute("data-type") &&
                            !passRuleOk(pass.value)
                        ) {
                            e.preventDefault();
                            if (formErr)
                                formErr.textContent =
                                    "Пароль: минимум 8 символов и латинские буквы";
                            return;
                        }
                        if (pass2 && pass && pass2.value !== pass.value) {
                            e.preventDefault();
                            setPass2Msg();
                            return;
                        }
                        const submit = form.querySelector(
                            'button[type="submit"]'
                        );
                        if (submit && submit.disabled) {
                            e.preventDefault();
                            return;
                        }
                    });
                }

                // code 8 inputs UX
                function bindCodeForm(form) {
                    const cells = Array.from(
                        form.querySelectorAll(".code-cell")
                    );
                    cells.forEach((inp, idx) => {
                        inp.addEventListener("input", (e) => {
                            let v = inp.value
                                .toUpperCase()
                                .replace(/[^A-Z0-9]/g, "");
                            inp.value = v.slice(0, 1);
                            if (inp.value && idx < cells.length - 1)
                                cells[idx + 1].focus();
                            updateSubmitState(form);
                        });
                        inp.addEventListener("keydown", (e) => {
                            if (
                                e.key === "Backspace" &&
                                !inp.value &&
                                idx > 0
                            ) {
                                cells[idx - 1].focus();
                            }
                            if (e.key === "-" && idx === 3) {
                                cells[4].focus();
                                e.preventDefault();
                            }
                        });
                        inp.addEventListener("paste", (e) => {
                            const data = (e.clipboardData.getData("text") || "")
                                .toUpperCase()
                                .replace(/[^A-Z0-9]/g, "");
                            if (!data) return;
                            e.preventDefault();
                            for (let i = 0; i < Math.min(8, data.length); i++) {
                                cells[i].value = data[i];
                            }
                            cells[data.length < 8 ? data.length : 7].focus();
                            updateSubmitState(form);
                        });
                    });
                }

                // Open/close helpers (also used by your code)
                function closeAnyModals() {
                    document.querySelectorAll(".modal").forEach((m) => {
                        if (!m.hidden) {
                            m.classList.remove("modal--open");
                            m.addEventListener(
                                "transitionend",
                                () => (m.hidden = true),
                                {
                                    once: true,
                                }
                            );
                        }
                    });
                    document.body.style.overflow = "";
                }
                function openModalById(id) {
                    const m = document.getElementById(id);
                    if (!m) return;
                    closeAnyModals();
                    m.hidden = false;
                    requestAnimationFrame(() => m.classList.add("modal--open"));
                    document.body.style.overflow = "hidden";
                    const first = m.querySelector(
                        'input,button,select,textarea,[tabindex]:not([tabindex="-1"])'
                    );
                    first && first.focus();
                }
                function closeModalById(id) {
                    const m = document.getElementById(id);
                    if (!m) return;
                    m.classList.remove("modal--open");
                    m.addEventListener(
                        "transitionend",
                        () => {
                            m.hidden = true;
                            document.body.style.overflow = "";
                        },
                        { once: true }
                    );
                }
                window.openModalById = openModalById;
                window.closeModalById = closeModalById;
                window.closeAnyModals = closeAnyModals;

                document.addEventListener("DOMContentLoaded", () => {
                    mountModals();

                    // hook your existing Login modal three buttons if present
                    const loginModal = document.getElementById("loginModal");
                    if (loginModal) {
                        const btns =
                            loginModal.querySelectorAll(".modal__body .btn");
                        const [btnCode, btnLogin, btnReg] = btns;
                        btnCode?.addEventListener("click", () => {
                            closeModalById("loginModal");
                            openModalById("codeModal");
                        });
                        btnLogin?.addEventListener("click", () => {
                            closeModalById("loginModal");
                            openModalById("authModal");
                        });
                        btnReg?.addEventListener("click", () => {
                            closeModalById("loginModal");
                            openModalById("regModal");
                        });
                    }

                    // forms enhance
                    [
                        "regForm",
                        "profileForm",
                        "authForm",
                        "codeForm",
                        "forgotForm",
                    ].forEach((id) => {
                        const f = document.getElementById(id);
                        if (!f) return;
                        persistForm(f);
                        addEyes(f);
                        bindErrors(f);
                        if (id === "codeForm") bindCodeForm(f);
                        // initial button state
                        updateSubmitState(f);
                    });

                    // global key ESC
                    document.addEventListener("keydown", (e) => {
                        if (e.key === "Escape") {
                            const open = Array.from(
                                document.querySelectorAll(".modal")
                            ).find((m) => !m.hidden);
                            if (open) closeAnyModals();
                        }
                    });

                    // data-open / data-close (works also on nested SVG)
                    document.body.addEventListener(
                        "click",
                        (e) => {
                            const closeEl = e.target.closest?.("[data-close]");
                            if (closeEl) {
                                closeModalById(
                                    closeEl.getAttribute("data-close")
                                );
                                e.preventDefault();
                                return;
                            }
                            const openEl = e.target.closest?.("[data-open]");
                            if (openEl) {
                                openModalById(openEl.getAttribute("data-open"));
                                e.preventDefault();
                            }
                        },
                        true
                    );
                });
            })();
            // ===== PATCH • 2025-10-05 =====
            (function () {
                const $ = (s, r = document) => r.querySelector(s);
                const $$ = (s, r = document) =>
                    Array.from(r.querySelectorAll(s));

                // email/пароль — проверки
                const isValidEmail = (v) =>
                    /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());
                const noCyrillic = (s) => !/[А-Яа-яЁё]/.test(s || "");
                const passRuleOk = (s) =>
                    (s || "").length >= 8 &&
                    noCyrillic(s) &&
                    /[A-Za-z]/.test(s);

                // Обновление доступности кнопки формы
                function updateSubmitState(form) {
                    const submit = form.querySelector('button[type="submit"]');
                    if (!submit) return;

                    let ok = true;
                    form.querySelectorAll("[data-required]").forEach((el) => {
                        if (!(el.value || "").trim()) ok = false;
                    });
                    form.querySelectorAll('[data-type="email"]').forEach(
                        (el) => {
                            if (!isValidEmail(el.value)) ok = false;
                        }
                    );
                    form.querySelectorAll("[data-required-check]").forEach(
                        (ch) => {
                            if (!ch.checked) ok = false;
                        }
                    );

                    // Правила пароля + live-ошибка
                    const pass = form.querySelector(
                        'input[name="pass"][data-type]'
                    );
                    const passMsg = form.querySelector(
                        '[data-error-for="pass"]'
                    );
                    if (pass) {
                        const good = passRuleOk(pass.value);
                        if (!good) {
                            ok = false;
                            if (passMsg)
                                passMsg.textContent =
                                    "Минимум 8 символов и латинские буквы";
                        } else if (passMsg) passMsg.textContent = "";
                    }

                    // Совпадение паролей + сообщение под вторым полем
                    const pass2 = form.querySelector('input[name="pass2"]');
                    const pass2Msg = form.querySelector(
                        '[data-error-for="pass2"]'
                    );
                    if (pass && pass2) {
                        if (pass2.value && pass2.value !== pass.value) {
                            ok = false;
                            if (pass2Msg)
                                pass2Msg.textContent = "Пароли не совпадают";
                        } else if (pass2Msg) pass2Msg.textContent = "";
                    }

                    // Код (8 символов в 8 ячейках)
                    if (form.id === "codeForm") {
                        const cells = Array.from(
                            form.querySelectorAll(".code-cell")
                        );
                        const code = cells
                            .map((i) => (i.value || "").trim())
                            .join("");
                        const hidden = form.querySelector('input[name="code"]');
                        if (hidden)
                            hidden.value = code.slice(0, 8).toUpperCase();
                        if (code.length !== 8) ok = false;
                    }

                    submit.disabled = !ok;
                    submit.classList.toggle("is-disabled", !ok);
                }
                window.__QUBIT_updateSubmitState = updateSubmitState;

                // Навешиваем обработчики на формы (если уже есть/добавлены динамически)
                function enhanceForm(id) {
                    const f = document.getElementById(id);
                    if (!f) return;
                    const onAny = () => updateSubmitState(f);
                    f.addEventListener("input", onAny);
                    f.addEventListener("change", onAny);
                    f.addEventListener("keyup", onAny);

                    // "Глаз": состояние + диагональная черта, чтобы видно открыто/закрыто
                    f.querySelectorAll(".input-group .input-toggle").forEach(
                        (btn) => {
                            const inp = btn.parentElement.querySelector(
                                'input[type="password"], input[type="text"]'
                            );
                            if (!inp) return;
                            const sync = () => {
                                const open = inp.type !== "password";
                                btn.dataset.open = open ? "true" : "false";
                                btn.classList.toggle("line", !open);
                            };
                            btn.addEventListener("click", () => {
                                inp.type =
                                    inp.type === "password"
                                        ? "text"
                                        : "password";
                                sync();
                                onAny();
                            });
                            sync();
                        }
                    );

                    // Живое сообщение под повтором пароля
                    const pass = f.querySelector('input[name="pass"]');
                    const pass2 = f.querySelector('input[name="pass2"]');
                    const pass2Msg = f.querySelector(
                        '[data-error-for="pass2"]'
                    );
                    const syncPass2 = () => {
                        if (!pass2Msg) return;
                        if (
                            (pass2?.value || "") &&
                            pass &&
                            pass2.value !== pass.value
                        )
                            pass2Msg.textContent = "Пароли не совпадают";
                        else pass2Msg.textContent = "";
                    };
                    pass?.addEventListener("input", syncPass2);
                    pass2?.addEventListener("input", syncPass2);

                    // Блокируем submit, если disabled (на всякий случай)
                    f.addEventListener("submit", (e) => {
                        const s = f.querySelector('button[type="submit"]');
                        if (s && s.disabled) e.preventDefault();
                    });

                    // Инициализация
                    updateSubmitState(f);
                }

                // Применяем ко всем нашим формам (если они у тебя уже в DOM)
                [
                    "regForm",
                    "profileForm",
                    "authForm",
                    "codeForm",
                    "forgotForm",
                ].forEach(enhanceForm);

                // Если формы монтируются динамически твоим кодом позже — вызови:
                //   window.__QUBIT_updateSubmitState(document.getElementById('regForm'))
            })();
            // ===== PATCH • 2025-10-05 =====
            (function () {
                const $ = (s, r = document) => r.querySelector(s);
                const $$ = (s, r = document) =>
                    Array.from(r.querySelectorAll(s));

                // Иконки глаза
                const EYE_CLOSE =
                    '<svg width="18" height="18" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12zm11 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="currentColor"/></svg>';
                const EYE_OPEN =
                    '<svg width="18" height="18" viewBox="0 0 24 24"><path d="M17.94 17.94A10.7 10.7 0 0 1 12 19c-7 0-11-7-11-7a18.9 18.9 0 0 1 4.19-4.86M7 7a10.7 10.7 0 0 1 5-2c7 0 11 7 11 7a18.9 18.9 0 0 1-4.1 4.75M1 1l22 22" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>';

                // Валидаторы
                const isValidEmail = (v) =>
                    /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());
                const noCyrillic = (s) => !/[А-Яа-яЁё]/.test(s || "");
                const passRuleOk = (s) =>
                    (s || "").length >= 8 &&
                    noCyrillic(s) &&
                    /[A-Za-z]/.test(s);

                // Обновление доступности сабмита
                function updateSubmitState(form) {
                    const submit = form.querySelector('button[type="submit"]');
                    if (!submit) return;
                    let ok = true;

                    // required: поддерживаем data-required и native required
                    form.querySelectorAll(
                        "[data-required], [required]"
                    ).forEach((el) => {
                        if (!(el.value || "").trim()) ok = false;
                    });
                    // email: data-type="email" или type=email
                    form.querySelectorAll(
                        '[data-type="email"], input[type="email"]'
                    ).forEach((el) => {
                        if (!isValidEmail(el.value)) ok = false;
                    });
                    // чекбокс
                    form.querySelectorAll(
                        '[data-required-check], input[type="checkbox"][required]'
                    ).forEach((ch) => {
                        if (!ch.checked) ok = false;
                    });

                    // пароль + подсказка
                    const pass = form.querySelector('input[name="pass"]');
                    const passMsg = form.querySelector(
                        '[data-error-for="pass"]'
                    );
                    if (pass) {
                        const good = passRuleOk(pass.value);
                        if (!good) {
                            ok = false;
                            if (passMsg)
                                passMsg.textContent =
                                    "Минимум 8 символов и латинские буквы";
                        } else if (passMsg) passMsg.textContent = "";
                    }

                    // повтор пароля + подсказка под вторым полем
                    const pass2 = form.querySelector('input[name="pass2"]');
                    const pass2Msg = form.querySelector(
                        '[data-error-for="pass2"]'
                    );
                    if (pass && pass2) {
                        if (pass2.value && pass2.value !== pass.value) {
                            ok = false;
                            if (pass2Msg)
                                pass2Msg.textContent = "Пароли не совпадают";
                        } else if (pass2Msg) pass2Msg.textContent = "";
                    }

                    // форма кода — 8 ячеек
                    if (form.id === "codeForm") {
                        const cells = Array.from(
                            form.querySelectorAll(".code-cell")
                        );
                        const code = cells
                            .map((i) => (i.value || "").trim())
                            .join("");
                        const hidden = form.querySelector('input[name="code"]');
                        if (hidden)
                            hidden.value = code.slice(0, 8).toUpperCase();
                        if (code.length !== 8) ok = false;
                    }

                    submit.disabled = !ok;
                    submit.classList.toggle("is-disabled", !ok);
                }
                window.__QUBIT_updateSubmitState = updateSubmitState;

                // Переключатель глаза: меняем SVG и aria-label
                function bindEyes(form) {
                    form.querySelectorAll(".input-group .input-toggle").forEach(
                        (btn) => {
                            const inp = btn.parentElement.querySelector(
                                'input[type="password"], input[type="text"]'
                            );
                            if (!inp) return;
                            const sync = () => {
                                const open = inp.type !== "password";
                                btn.innerHTML = open ? EYE_CLOSE : EYE_OPEN;
                                btn.setAttribute(
                                    "aria-label",
                                    open ? "Скрыть пароль" : "Показать пароль"
                                );
                            };
                            btn.addEventListener("click", () => {
                                inp.type =
                                    inp.type === "password"
                                        ? "text"
                                        : "password";
                                sync();
                            });
                            sync();
                        }
                    );
                }

                function enhanceForm(id) {
                    const f = document.getElementById(id);
                    if (!f) return;
                    const any = () => updateSubmitState(f);
                    f.addEventListener("input", any);
                    f.addEventListener("change", any);
                    f.addEventListener("keyup", any);
                    bindEyes(f);
                    f.addEventListener("submit", (e) => {
                        const s = f.querySelector('button[type="submit"]');
                        if (s && s.disabled) e.preventDefault();
                    });
                    updateSubmitState(f);
                }

                // Удаляем «Войти по коду» из авторизации (если внезапно появится)
                function removeCodeLinkEverywhere() {
                    document.querySelectorAll(".form__links a").forEach((a) => {
                        if ((a.textContent || "").toLowerCase().includes("код"))
                            a.remove();
                    });
                }

                // При закрытии модалки очищаем форму и ошибки (и ничего не сохраняем)
                const prevCloseById = window.closeModalById;
                const prevCloseAny = window.closeAnyModals;
                function resetFormsIn(el) {
                    el.querySelectorAll("form").forEach((f) => {
                        f.reset();
                        f.querySelectorAll(
                            "[data-form-error],[data-error-for]"
                        ).forEach((n) => (n.textContent = ""));
                        const s = f.querySelector('button[type="submit"]');
                        if (s) {
                            s.disabled = true;
                            s.classList.add("is-disabled");
                        }
                    });
                }
                window.closeModalById = function (id) {
                    const m = document.getElementById(id);
                    if (!m) {
                        return prevCloseById && prevCloseById(id);
                    }
                    m.classList.remove("modal--open");
                    m.addEventListener(
                        "transitionend",
                        () => {
                            m.hidden = true;
                            resetFormsIn(m);
                            document.body.style.overflow = "";
                        },
                        { once: true }
                    );
                };
                window.closeAnyModals = function () {
                    document.querySelectorAll(".modal").forEach((m) => {
                        if (!m.hidden) {
                            m.classList.remove("modal--open");
                            m.addEventListener(
                                "transitionend",
                                () => {
                                    m.hidden = true;
                                    resetFormsIn(m);
                                },
                                { once: true }
                            );
                        }
                    });
                    document.body.style.overflow = "";
                };

                document.addEventListener("DOMContentLoaded", () => {
                    [
                        "regForm",
                        "profileForm",
                        "authForm",
                        "codeForm",
                        "forgotForm",
                    ].forEach(enhanceForm);
                    removeCodeLinkEverywhere(); // ещё раз на всякий случай
                });
            })();

            // ===== FIX v3 — 2025‑10‑05 =====
            (function () {
                if (window.QUBIT_FIX_V3) return;
                window.QUBIT_FIX_V3 = true;
                const $ = (s, r = document) => r.querySelector(s);
                const $$ = (s, r = document) =>
                    Array.from(r.querySelectorAll(s));

                // 0) Убираем любое сохранение форм "form:*" и чистим старые записи
                try {
                    const _setItem = localStorage.setItem.bind(localStorage);
                    localStorage.setItem = function (k, v) {
                        if (String(k).startsWith("form:")) return;
                        return _setItem(k, v);
                    };
                    for (let i = localStorage.length - 1; i >= 0; i--) {
                        const k = localStorage.key(i);
                        if (k && k.startsWith("form:"))
                            localStorage.removeItem(k);
                    }
                } catch {}

                // 1) Валидаторы
                const isEmail = (v) =>
                    /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((v || "").trim());
                const noCyr = (s) => !/[А-Яа-яЁё]/.test(s || "");
                const passOK = (s) =>
                    (s || "").length >= 8 && noCyr(s) && /[A-Za-z]/.test(s);

                function updateSubmitState(form) {
                    const btn = form.querySelector('button[type="submit"]');
                    if (!btn) return;
                    let ok = true;

                    form.querySelectorAll(
                        "[data-required], [required]"
                    ).forEach((el) => {
                        if (!(el.value || "").trim()) ok = false;
                    });
                    form.querySelectorAll(
                        '[data-type="email"], input[type="email"]'
                    ).forEach((el) => {
                        if (!isEmail(el.value)) ok = false;
                    });
                    form.querySelectorAll(
                        '[data-required-check], input[type="checkbox"][required]'
                    ).forEach((ch) => {
                        if (!ch.checked) ok = false;
                    });

                    const p = form.querySelector('input[name="pass"]');
                    const p2 = form.querySelector('input[name="pass2"]');
                    const msgP = form.querySelector('[data-error-for="pass"]');
                    const msgP2 = form.querySelector(
                        '[data-error-for="pass2"]'
                    );

                    if (p) {
                        const okP = passOK(p.value);
                        if (!okP) {
                            ok = false;
                            if (msgP)
                                msgP.textContent =
                                    "Минимум 8 символов и латинские буквы";
                        } else if (msgP) msgP.textContent = "";
                    }
                    if (p && p2) {
                        if (p2.value && p2.value !== p.value) {
                            ok = false;
                            if (msgP2)
                                msgP2.textContent = "Пароли не совпадают";
                        } else if (msgP2) msgP2.textContent = "";
                    }

                    if (form.id === "codeForm") {
                        const cells = Array.from(
                            form.querySelectorAll(".code-cell")
                        );
                        const code = cells
                            .map((i) => (i.value || "").trim())
                            .join("");
                        const hidden = form.querySelector('input[name="code"]');
                        if (hidden)
                            hidden.value = code.slice(0, 8).toUpperCase();
                        if (code.length !== 8) ok = false;
                    }

                    btn.disabled = !ok;
                    btn.classList.toggle("is-disabled", !ok);
                }
                window.__QUBIT_updateSubmitState = updateSubmitState;

                // 2) Глазики: кликаются и меняют иконку (открыт/закрыт)
                const EYE_CLOSE =
                    '<svg width="18" height="18" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12zm11 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" fill="currentColor"/></svg>';
                const EYE_OPEN =
                    '<svg width="18" height="18" viewBox="0 0 24 24"><path d="M17.94 17.94A10.7 10.7 0 0 1 12 19c-7 0-11-7-11-7a18.9 18.9 0 0 1 4.19-4.86M7 7a10.7 10.7 0 0 1 5-2c7 0 11 7 11 7a18.9 18.9 0 0 1-4.1 4.75M1 1l22 22" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>';
                function bindEyes(form) {
                    form.querySelectorAll(".input-group .input-toggle").forEach(
                        (btn) => {
                            const inp = btn
                                .closest(".input-group")
                                .querySelector("input");
                            if (!inp) return;
                            const sync = () => {
                                const open = inp.type !== "password";
                                btn.innerHTML = open ? EYE_CLOSE : EYE_OPEN;
                                btn.setAttribute(
                                    "aria-label",
                                    open ? "Скрыть пароль" : "Показать пароль"
                                );
                            };
                            btn.addEventListener("click", () => {
                                inp.type =
                                    inp.type === "password"
                                        ? "text"
                                        : "password";
                                sync();
                            });
                            sync();
                        }
                    );
                }

                // 3) Улучшаем формы
                function enhanceForm(id) {
                    const f = document.getElementById(id);
                    if (!f) return;
                    const any = () => updateSubmitState(f);
                    f.addEventListener("input", any);
                    f.addEventListener("change", any);
                    f.addEventListener("keyup", any);
                    f.addEventListener("submit", (e) => {
                        const s = f.querySelector('button[type="submit"]');
                        if (s && s.disabled) {
                            e.preventDefault();
                            return;
                        }
                    });
                    bindEyes(f);
                    updateSubmitState(f);
                }

                // 4) Сброс форм при закрытии модалки (и быстрая смена между модалками)
                function resetFormsIn(el) {
                    el.querySelectorAll("form").forEach((f) => {
                        f.reset();
                        f.querySelectorAll(
                            "[data-form-error],[data-error-for]"
                        ).forEach((n) => (n.textContent = ""));
                        const s = f.querySelector('button[type="submit"]');
                        if (s) {
                            s.disabled = true;
                            s.classList.add("is-disabled");
                        }
                    });
                }
                window.swapModal = function (fromId, toId) {
                    const fm = document.getElementById(fromId);
                    if (fm && !fm.hidden) {
                        fm.hidden = true;
                        fm.classList.remove("modal--open");
                    }
                    // тело остаётся заблокированным
                    document.body.style.overflow = "hidden";
                    const tm = document.getElementById(toId);
                    if (tm) {
                        tm.hidden = false;
                        requestAnimationFrame(() =>
                            tm.classList.add("modal--open")
                        );
                    }
                };

                // 5) Drag‑scroll для турниров (+убираем выделение текста при перетаскивании)
                (function () {
                    const scroller = document.getElementById("hscroll");
                    if (!scroller) return;
                    let isDown = false,
                        startX = 0,
                        startLeft = 0,
                        moved = false;
                    const onDown = (e) => {
                        isDown = true;
                        moved = false;
                        startX = e.touches ? e.touches[0].pageX : e.pageX;
                        startLeft = scroller.scrollLeft;
                        scroller.classList.add("dragging");
                    };
                    const onMove = (e) => {
                        if (!isDown) return;
                        const x = e.touches ? e.touches[0].pageX : e.pageX;
                        const dx = x - startX;
                        if (Math.abs(dx) > 3) moved = true;
                        scroller.scrollLeft = startLeft - dx;
                        e.preventDefault();
                    };
                    const onUp = () => {
                        isDown = false;
                        scroller.classList.remove("dragging");
                    };
                    scroller.addEventListener("mousedown", onDown);
                    scroller.addEventListener("mousemove", onMove);
                    document.addEventListener("mouseup", onUp);
                    scroller.addEventListener("touchstart", onDown, {
                        passive: false,
                    });
                    scroller.addEventListener("touchmove", onMove, {
                        passive: false,
                    });
                    scroller.addEventListener("touchend", onUp);
                    // блокируем клики по карточкам если это был drag
                    scroller.addEventListener(
                        "click",
                        (e) => {
                            if (moved) {
                                e.preventDefault();
                                e.stopPropagation();
                            }
                        },
                        true
                    );
                })();

                // 6) Поведение модалок/форм
                document.addEventListener("DOMContentLoaded", () => {
                    // формочки из наших модалок (если они уже смонтированы твоим кодом)
                    [
                        "regForm",
                        "profileForm",
                        "authForm",
                        "codeForm",
                        "forgotForm",
                    ].forEach(enhanceForm);

                    // Login modal кнопки (если есть)
                    const loginModal = $("#loginModal");
                    if (loginModal) {
                        const btns =
                            loginModal.querySelectorAll(".modal__body .btn");
                        const [btnCode, btnLogin, btnReg] = btns;
                        btnCode &&
                            btnCode.addEventListener("click", () =>
                                swapModal("loginModal", "codeModal")
                            );
                        btnLogin &&
                            btnLogin.addEventListener("click", () =>
                                swapModal("loginModal", "authModal")
                            );
                        btnReg &&
                            btnReg.addEventListener("click", () =>
                                swapModal("loginModal", "regModal")
                            );
                    }

                    // После успешной регистрации — сразу "О себе" (без мерцаний)
                    const regForm = $("#regForm");
                    regForm &&
                        regForm.addEventListener("submit", (e) => {
                            const btn = regForm.querySelector(
                                'button[type="submit"]'
                            );
                            if (btn && btn.disabled) {
                                e.preventDefault();
                                return;
                            }
                            e.preventDefault();
                            resetFormsIn(regForm.closest(".modal"));
                            swapModal("regModal", "profileModal");
                        });

                    // При закрытии любой модалки — очищаем её поля
                    document.body.addEventListener(
                        "click",
                        (e) => {
                            const closer = e.target.closest?.("[data-close]");
                            if (closer) {
                                const id = closer.getAttribute("data-close");
                                const m = document.getElementById(id);
                                if (m) {
                                    m.classList.remove("modal--open");
                                    m.addEventListener(
                                        "transitionend",
                                        () => {
                                            m.hidden = true;
                                            resetFormsIn(m);
                                            document.body.style.overflow = "";
                                        },
                                        { once: true }
                                    );
                                    e.preventDefault();
                                }
                            }
                        },
                        true
                    );
                });
            })();
            // === Регистрация: валидация полей ===
            const $ = (s, r = document) => r.querySelector(s);

            const regLogin = $("#regLogin");
            const regEmail = $("#regEmail");
            const regPass = $("#regPass");
            const regPass2 = $("#regPass2");
            const regBtn = $("#regSubmit"); // id на кнопке "Зарегистрироваться"
            const eLogin = $('[data-error-for="login"]');
            const eEmail = $('[data-error-for="email"]');
            const ePass = $('[data-error-for="pass"]');
            const ePass2 = $('[data-error-for="pass2"]');

            const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
            const passRe = /^(?=.*[A-Za-z]).{8,}$/; // ≥8 символов и хотя бы 1 латинская буква

            function validateRegForm() {
                let ok = true;

                // Логин
                const loginVal = (regLogin?.value || "").trim();
                if (loginVal.length < 2) {
                    eLogin.textContent =
                        "Логин должен быть не короче 2 символов";
                    ok = false;
                } else {
                    eLogin.textContent = "";
                }

                // Почта
                const emailVal = (regEmail?.value || "").trim();
                console.log(emailVal);
                const validateEmail = (emailVal) => {
                    return String(emailVal)
                        .toLowerCase()
                        .match(
                            /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                        );
                };
                console.log(validateEmail);
                if (validateEmail) {
                    eEmail.textContent =
                        "Введите корректный e-mail (например, name@mail.ru)";
                    ok = false;
                } else {
                    eEmail.textContent = "";
                }

                // Пароль: правила
                const p1 = regPass?.value || "";
                if (!passRe.test(p1)) {
                    ePass.textContent =
                        "Минимум 8 символов и хотя бы 1 английская буква";
                    ok = false;
                } else {
                    ePass.textContent = "";
                }

                // Совпадение паролей
                const p2 = regPass2?.value || "";
                if (p1 !== p2) {
                    ePass2.textContent = "Пароли не совпадают";
                    ok = false;
                } else {
                    ePass2.textContent = "";
                }

                // Кнопка: серая, пока форма невалидна (используем ваш стиль disabled)
                if (regBtn) {
                    regBtn.disabled = !ok;
                    regBtn.classList.toggle("is-disabled", !ok);
                }
                return ok;
            }

            // Обновляем ошибки на вводе/потере фокуса
            [regLogin, regEmail, regPass, regPass2].forEach((el) => {
                if (!el) return;
                ["input", "blur"].forEach((ev) =>
                    el.addEventListener(ev, validateRegForm)
                );
            });

            // Защита при submit
            const regForm = $("#regForm"); // поставьте id="regForm" вашей форме регистрации
            if (regForm) {
                regForm.addEventListener("submit", (e) => {
                    if (!validateRegForm()) e.preventDefault();
                });
            }

            // === Показать/скрыть пароль с «перечёркиванием» глаза ===
            function wireEye(input, toggleBtn) {
                if (!input || !toggleBtn) return;
                const eyePath = toggleBtn.querySelector("svg path"); // подхватите нужный элемент
                const lineClass = "line"; // в CSS для .input-toggle.line добавлена диагональная черта

                toggleBtn.addEventListener("click", () => {
                    const isHidden = input.type === "password";
                    input.type = isHidden ? "text" : "password";
                    toggleBtn.classList.toggle(lineClass, !isHidden);
                });
            }
            wireEye(regPass, $("#regPassToggle"));
            wireEye(regPass2, $("#regPass2Toggle"));
        </script>
    </body>
</html>
